# Weekend Stories Data Structure

This directory contains the data structure, parser, and formatter for Weekend Stories generated by the GPT model.

## Overview

Weekend Stories are structured narratives consisting of 24 scenes, each with an introduction and conversation between the coaches. The data structure organizes these stories in a way that's easy to parse, store, and integrate with Discord.

## File Structure

- `types.ts`: TypeScript type definitions for the Weekend Story data structure
- `parser.js`: Utility for parsing GPT output into structured JSON
- `formatter.js`: Utility for formatting structured data into Discord-compatible messages

## Data Model

Each Weekend Story follows this structure:

```typescript
interface WeekendStory {
  metadata: {
    generated: string;          // ISO timestamp
    storyType: string;          // e.g., "weekend2"
    city: string;               // e.g., "Berlin"
    locationGoal: string;       // e.g., "Berghain"
    object: string;             // e.g., "metal drink token"
  };
  
  scenes: Array<{
    number: number;             // 1-24
    intro: {
      time: string;             // e.g., "8:12 PM"
      location: string;         // e.g., "Berlin"
      behavior: string;         // e.g., "the streetlights are starting to blink"
    };
    conversation: Array<{
      coach: string;            // e.g., "kailey_sloan", "venusmetrics", etc.
      content: string;          // The message content
      timestamp: string;        // e.g., "8:12 PM"
    }>;
  }>;
}
```

## Usage

### Parsing GPT Output

```javascript
const parser = require('./parser.js');

// Parse GPT output with metadata
const parsedStory = parser.parseWeekendStory(gptOutput, {
  storyType: "weekend2",
  city: "Berlin",
  locationGoal: "Berghain",
  object: "metal drink token"
});

// Save to a JSON file
fs.writeFileSync('story.json', JSON.stringify(parsedStory, null, 2));
```

### Formatting for Discord

```javascript
const formatter = require('./formatter.js');

// Format a single scene for Discord
const formattedScene = formatter.formatSceneForDiscord(parsedStory.scenes[0]);

// Format the entire story as separate Discord messages
const discordMessages = formatter.formatStoryForDiscord(parsedStory);

// Format for Discord webhooks
const webhookPayloads = formatter.formatStoryForWebhooks(parsedStory);
```

## Integration with test-weekend2-story.js

To integrate this data structure with the existing `test-weekend2-story.js`:

1. Import the parser in `test-weekend2-story.js`:
   ```javascript
   const parser = require('./data/weekend-stories/parser.js');
   ```

2. After generating the GPT response, parse it:
   ```javascript
   const parsedStory = parser.parseWeekendStory(response, {
     storyType: "weekend2",
     city: "Berlin",
     locationGoal: "Berghain", 
     object: "metal drink token"
   });
   ```

3. Save both the raw output and structured JSON:
   ```javascript
   // Save the structured JSON
   const jsonPath = path.join(__dirname, `data/weekend-stories/weekend2-story-${timestamp}.json`);
   fs.writeFileSync(jsonPath, JSON.stringify(parsedStory, null, 2), "utf8");
   ```

## Testing

Use the `test-weekend2-parser.js` script to test parsing existing GPT output files:

```bash
node test-weekend2-parser.js weekend2_story_output-2025-05-11T17-00-29-025Z.txt
```

This will parse the specified file and save the structured JSON in the `data/weekend-stories/` directory. 