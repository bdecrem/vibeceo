<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R1-D1 Synthesizer</title>
    <link rel="stylesheet" href="styles.css">
    <meta name="theme-color" content="#c8c8c8">
    <meta property="og:title" content="R1-D1 Synthesizer">
    <meta property="og:description" content="Web Audio monophonic synthesizer inspired by the SH-101">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://kochi.to/101/og.png">
    <meta property="og:url" content="https://kochi.to/101/">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://kochi.to/101/og.png">
</head>
<body>
    <div class="synth-container">
        <!-- Header -->
        <header class="synth-header">
            <div class="logo">
                <span class="brand">KOCHI</span>
                <span class="model">R1-D1</span>
            </div>
            <div class="header-controls">
                <select id="preset-select" class="preset-selector">
                    <option value="">Select Preset...</option>
                </select>
                <div class="engine-toggle">
                    <button id="engine-e1" class="engine-btn active">E1</button>
                    <button id="engine-e2" class="engine-btn">E2</button>
                </div>
                <button id="share-btn" class="header-icon-btn" title="Export / Import">
                    <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                </button>
                <button id="info-btn" class="info-btn" title="Info">?</button>
            </div>
        </header>

        <!-- Main Control Panel -->
        <main class="control-panel">
            <!-- VCO Section -->
            <section class="section vco-section">
                <h3>VCO</h3>
                <div class="controls-row">
                    <div class="control">
                        <div class="knob" data-param="vcoSaw" data-value="0.5"></div>
                        <label>SAW</label>
                    </div>
                    <div class="control">
                        <div class="knob" data-param="vcoPulse" data-value="0.5"></div>
                        <label>PULSE</label>
                    </div>
                    <div class="control">
                        <div class="knob" data-param="pulseWidth" data-value="0.5"></div>
                        <label>PW</label>
                    </div>
                </div>
                <div class="range-switch">
                    <span class="range-label">RANGE</span>
                    <div class="range-buttons">
                        <button class="range-btn" data-range="16">16'</button>
                        <button class="range-btn active" data-range="8">8'</button>
                        <button class="range-btn" data-range="4">4'</button>
                        <button class="range-btn" data-range="2">2'</button>
                    </div>
                </div>
            </section>

            <!-- Sub Oscillator Section -->
            <section class="section sub-section">
                <h3>SUB</h3>
                <div class="controls-row">
                    <div class="control">
                        <div class="knob" data-param="subLevel" data-value="0.3"></div>
                        <label>LEVEL</label>
                    </div>
                </div>
                <div class="sub-mode-switch">
                    <span class="mode-label">MODE</span>
                    <div class="mode-buttons">
                        <button class="mode-btn active" data-mode="0">OFF</button>
                        <button class="mode-btn" data-mode="1">-1</button>
                        <button class="mode-btn" data-mode="2">-2</button>
                        <button class="mode-btn" data-mode="3">25%</button>
                    </div>
                </div>
            </section>

            <!-- Filter Section -->
            <section class="section filter-section">
                <h3>VCF</h3>
                <div class="controls-row">
                    <div class="control">
                        <div class="knob" data-param="cutoff" data-value="0.5"></div>
                        <label>FREQ</label>
                    </div>
                    <div class="control">
                        <div class="knob" data-param="resonance" data-value="0.3"></div>
                        <label>RES</label>
                    </div>
                    <div class="control">
                        <div class="knob" data-param="envMod" data-value="0.5"></div>
                        <label>ENV</label>
                    </div>
                </div>
            </section>

            <!-- Envelope Section -->
            <section class="section env-section">
                <h3>ENV</h3>
                <div class="controls-row">
                    <div class="control">
                        <div class="slider" data-param="attack" data-value="0.01"></div>
                        <label>A</label>
                    </div>
                    <div class="control">
                        <div class="slider" data-param="decay" data-value="0.3"></div>
                        <label>D</label>
                    </div>
                    <div class="control">
                        <div class="slider" data-param="sustain" data-value="0.7"></div>
                        <label>S</label>
                    </div>
                    <div class="control">
                        <div class="slider" data-param="release" data-value="0.3"></div>
                        <label>R</label>
                    </div>
                </div>
            </section>

            <!-- LFO Section -->
            <section class="section lfo-section">
                <h3>LFO</h3>
                <div class="controls-row">
                    <div class="control">
                        <div class="knob" data-param="lfoRate" data-value="0.3"></div>
                        <label>RATE</label>
                    </div>
                </div>
                <div class="lfo-waveform">
                    <button class="wave-btn active" data-wave="triangle">△</button>
                    <button class="wave-btn" data-wave="square">□</button>
                    <button class="wave-btn" data-wave="sh">S/H</button>
                </div>
                <div class="lfo-destinations">
                    <div class="control small">
                        <div class="knob small" data-param="lfoToPitch" data-value="0"></div>
                        <label>PITCH</label>
                    </div>
                    <div class="control small">
                        <div class="knob small" data-param="lfoToFilter" data-value="0"></div>
                        <label>VCF</label>
                    </div>
                    <div class="control small">
                        <div class="knob small" data-param="lfoToPW" data-value="0"></div>
                        <label>PW</label>
                    </div>
                </div>
            </section>

            <!-- Volume -->
            <section class="section volume-section">
                <h3>VCA</h3>
                <div class="controls-row">
                    <div class="control">
                        <div class="knob" data-param="volume" data-value="0.8"></div>
                        <label>VOL</label>
                    </div>
                </div>
            </section>
        </main>

        <!-- Sequencer Section -->
        <section class="sequencer-section">
            <div class="transport">
                <button id="rec-btn" class="transport-btn rec">REC</button>
                <button id="play-btn" class="transport-btn play">PLAY</button>
                <button id="stop-btn" class="transport-btn stop">STOP</button>
                <div class="bpm-control">
                    <label>BPM</label>
                    <input type="number" id="bpm-input" value="120" min="30" max="300">
                </div>
            </div>

            <div class="arp-controls">
                <span class="arp-label">ARP</span>
                <button class="arp-btn" data-mode="off">OFF</button>
                <button class="arp-btn" data-mode="up">UP</button>
                <button class="arp-btn" data-mode="down">DN</button>
                <button class="arp-btn" data-mode="updown">U/D</button>
                <button id="hold-btn" class="hold-btn">HOLD</button>
                <div class="octave-control">
                    <label>OCT</label>
                    <button class="oct-btn" data-oct="1">1</button>
                    <button class="oct-btn active" data-oct="2">2</button>
                    <button class="oct-btn" data-oct="3">3</button>
                </div>
            </div>

            <div class="step-grid">
                <!-- Steps will be generated by JS -->
            </div>
        </section>

        <!-- Keyboard Section -->
        <section class="keyboard-section">
            <div class="keyboard" id="keyboard">
                <!-- Keys will be generated by JS -->
            </div>
        </section>

        <!-- Footer -->
        <footer class="synth-footer">
            <span>Web Audio SH-101 Emulation</span>
        </footer>
    </div>

    <!-- Info Modal -->
    <div id="info-modal" class="modal hidden">
        <div class="modal-content">
            <button class="modal-close">&times;</button>
            <h2>R1-D1</h2>

            <p>The R1-D1 is a monophonic synthesizer inspired by classic 80s analog synths. Features a built-in sequencer/arpeggiator and distinctive sound.</p>

            <h3>Engine Modes</h3>
            <p><strong>E1 (Simple)</strong> - Uses Web Audio's built-in filters. Clean, digital sound. Lower CPU usage. Good for quick playback and mobile devices.</p>
            <p><strong>E2 (Authentic)</strong> - Emulates IR3109 filter chip. Warmer, more analog-like sound. Higher CPU usage. Good for final renders and detailed sound design.</p>

            <h3>Keyboard Shortcuts</h3>
            <table>
                <tr><td>A-L</td><td>Play notes (C3-E4)</td></tr>
                <tr><td>W,E,T,Y,U,O,P</td><td>Play sharps</td></tr>
                <tr><td>Z</td><td>Octave down</td></tr>
                <tr><td>X</td><td>Octave up</td></tr>
                <tr><td>Space</td><td>Play/Stop</td></tr>
            </table>

            <h3>Sub-Oscillator Modes</h3>
            <ul>
                <li><strong>-1</strong> - Square wave one octave below</li>
                <li><strong>-2</strong> - Square wave two octaves below</li>
                <li><strong>25%</strong> - 25% pulse two octaves below (sounds like -1 oct)</li>
            </ul>

            <h3>Arpeggiator Tips</h3>
            <ul>
                <li>Hold multiple keys for chords</li>
                <li>Use HOLD mode to accumulate notes</li>
                <li>Try different octave ranges</li>
            </ul>

            <p class="credits">Built with Web Audio API. Part of the Kochi.to synth collection.</p>
        </div>
    </div>

    <!-- Export/Import Modal -->
    <div id="share-modal" class="share-modal">
        <div class="share-modal-content">
            <div class="share-modal-header">
                <span class="share-modal-title">Export / Import</span>
                <button class="share-modal-close">&times;</button>
            </div>
            <div class="share-modal-body">
                <button id="export-btn" class="share-option">
                    <span class="share-option-icon">♫</span>
                    <span class="share-option-text">
                        <strong>Export WAV</strong>
                        <small>Download audio file</small>
                    </span>
                </button>
                <button id="export-json" class="share-option">
                    <span class="share-option-icon">{ }</span>
                    <span class="share-option-text">
                        <strong>Export Pattern</strong>
                        <small>Save as JSON file</small>
                    </span>
                </button>
                <button id="import-json" class="share-option">
                    <span class="share-option-icon">↑</span>
                    <span class="share-option-text">
                        <strong>Load Pattern</strong>
                        <small>Import from JSON</small>
                    </span>
                </button>
            </div>
        </div>
    </div>
    <input type="file" id="import-file" accept=".json" style="display: none" />

    <script type="module" src="app.js"></script>
</body>
</html>
