<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Goals</title>
    <link rel="icon" type="image/svg+xml" href="/amber/favicon.svg">
    <meta property="og:title" content="Weekly Goals">
    <meta property="og:description" content="Amber's weekly goal tracker - organized by week, updated through conversation">
    <meta property="og:image" content="https://intheamber.com/amber/goals-og.png">
    <meta property="og:url" content="https://intheamber.com/amber/goals.html">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Weekly Goals">
    <meta name="twitter:description" content="Amber's weekly goal tracker - organized by week, updated through conversation">
    <meta name="twitter:image" content="https://intheamber.com/amber/goals-og.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
            color: #d4af37;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.2);
        }

        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
        }

        .week-header {
            text-align: center;
            font-size: 1.2em;
            opacity: 0.8;
            margin-bottom: 30px;
            font-style: italic;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-style: italic;
            opacity: 0.7;
        }

        .goal {
            background: rgba(212, 175, 55, 0.08);
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .goal:hover {
            background: rgba(212, 175, 55, 0.12);
            border-color: rgba(212, 175, 55, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.2);
        }

        .goal-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #f5e6a8;
        }

        .goal-items {
            list-style: none;
            padding-left: 20px;
        }

        .goal-item {
            padding: 5px 0;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .goal-item:hover {
            color: #f5e6a8;
        }

        .checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid rgba(212, 175, 55, 0.6);
            border-radius: 3px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .checkbox.checked {
            background: rgba(212, 175, 55, 0.8);
            border-color: #d4af37;
        }

        .checkbox.checked::after {
            content: 'âœ“';
            color: #0f0f0f;
            font-weight: bold;
            font-size: 12px;
        }

        .goal-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(212, 175, 55, 0.2);
            border-radius: 4px;
            margin-top: 15px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #d4af37, #f5e6a8);
            border-radius: 4px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            font-size: 0.9em;
            opacity: 0.8;
        }

        .signature {
            text-align: center;
            margin-top: 40px;
            font-style: italic;
            opacity: 0.7;
            font-size: 0.9em;
        }

        .update-info {
            text-align: center;
            margin-top: 20px;
            font-size: 0.8em;
            opacity: 0.6;
            font-style: italic;
        }

        .sync-status {
            text-align: center;
            margin-top: 10px;
            font-size: 0.7em;
            opacity: 0.5;
            font-style: italic;
        }

        .sync-status.syncing {
            color: #f5e6a8;
            opacity: 0.8;
        }

        .sync-status.error {
            color: #ff6b6b;
            opacity: 0.8;
        }

        @media (max-width: 600px) {
            .container {
                margin: 10px;
                padding: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ”® Weekly Goals</h1>
        <div class="week-header" id="weekHeader">Week of February 10-16, 2026</div>
        
        <div id="loadingState" class="loading">
            Loading goals from Amber's memory...
        </div>

        <div id="goalsContainer" style="display: none;">
            <!-- Goals will be populated here -->
        </div>

        <div class="update-info">
            Talk to Amber to add goals, mark items complete, or update details
        </div>

        <div class="sync-status" id="syncStatus">
            Synced with Amber's memory
        </div>

        <div class="signature">â€” Amber</div>
    </div>

    <script>
        let currentGoals = {};
        let completionState = {};
        let isSyncing = false;

        // API functions
        async function loadGoals() {
            try {
                const response = await fetch('/api/amber/goals');
                const data = await response.json();
                
                if (data.content) {
                    currentGoals = JSON.parse(data.content);
                    completionState = data.metadata?.completion_state || {};
                } else {
                    // Default goals if none exist
                    currentGoals = {
                        networking: {
                            title: "Network with 5 people",
                            items: ["Riya Rani", "John Markoff", "[Person 3]", "[Person 4]", "[Person 5]"]
                        },
                        social: {
                            title: "5 social networking engagements", 
                            items: ["Engagement 1", "Engagement 2", "Engagement 3", "Engagement 4", "Engagement 5"]
                        },
                        twitter: {
                            title: "One Twitter explainer",
                            items: ["Twitter explainer post"]
                        }
                    };
                }
                
                renderGoals();
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('goalsContainer').style.display = 'block';
            } catch (error) {
                console.error('Error loading goals:', error);
                document.getElementById('loadingState').innerHTML = 'Error loading goals. Using offline mode.';
                // Fall back to localStorage
                loadFromLocalStorage();
            }
        }

        async function saveGoals() {
            if (isSyncing) return;
            
            isSyncing = true;
            updateSyncStatus('Syncing with Amber\'s memory...', 'syncing');
            
            try {
                const response = await fetch('/api/amber/goals', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        goals: currentGoals,
                        completionState: completionState
                    })
                });
                
                if (response.ok) {
                    updateSyncStatus('Synced with Amber\'s memory', 'synced');
                } else {
                    throw new Error('Save failed');
                }
            } catch (error) {
                console.error('Error saving goals:', error);
                updateSyncStatus('Sync error - saved locally', 'error');
                // Fall back to localStorage
                saveToLocalStorage();
            }
            
            isSyncing = false;
        }

        function updateSyncStatus(message, type) {
            const status = document.getElementById('syncStatus');
            status.textContent = message;
            status.className = `sync-status ${type}`;
            
            if (type === 'synced') {
                setTimeout(() => {
                    status.textContent = 'Synced with Amber\'s memory';
                    status.className = 'sync-status';
                }, 2000);
            }
        }

        // Fallback localStorage functions
        function loadFromLocalStorage() {
            const saved = localStorage.getItem('weeklyGoals');
            if (saved) {
                const data = JSON.parse(saved);
                currentGoals = data.goals || currentGoals;
                completionState = data.completionState || {};
            }
            renderGoals();
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('goalsContainer').style.display = 'block';
        }

        function saveToLocalStorage() {
            localStorage.setItem('weeklyGoals', JSON.stringify({
                goals: currentGoals,
                completionState: completionState
            }));
        }

        // Render goals HTML
        function renderGoals() {
            const container = document.getElementById('goalsContainer');
            container.innerHTML = '';

            Object.keys(currentGoals).forEach((goalKey, index) => {
                const goal = currentGoals[goalKey];
                const goalEl = document.createElement('div');
                goalEl.className = 'goal';
                goalEl.id = goalKey;

                let itemsHTML = '';
                goal.items.forEach((item, itemIndex) => {
                    const itemKey = `${goalKey}_${itemIndex}`;
                    const isCompleted = completionState[itemKey] || false;
                    const completedClass = isCompleted ? 'completed' : '';
                    const checkedClass = isCompleted ? 'checked' : '';
                    
                    itemsHTML += `
                        <li class="goal-item ${completedClass}" data-item="${itemKey}">
                            <div class="checkbox ${checkedClass}"></div>
                            <span>${item}</span>
                        </li>
                    `;
                });

                goalEl.innerHTML = `
                    <div class="goal-title">${goal.title}</div>
                    <ul class="goal-items">
                        ${itemsHTML}
                    </ul>
                    <div class="progress-bar">
                        <div class="progress-fill" id="${goalKey}Progress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="${goalKey}Text">0 of ${goal.items.length} completed</div>
                `;

                container.appendChild(goalEl);
            });

            // Add click handlers
            document.querySelectorAll('.goal-item').forEach(item => {
                item.addEventListener('click', () => toggleItem(item));
            });

            updateAllProgress();
        }

        // Toggle item completion
        function toggleItem(item) {
            const itemKey = item.dataset.item;
            const isCompleted = item.classList.contains('completed');
            const checkbox = item.querySelector('.checkbox');
            
            if (isCompleted) {
                item.classList.remove('completed');
                checkbox.classList.remove('checked');
                completionState[itemKey] = false;
            } else {
                item.classList.add('completed');
                checkbox.classList.add('checked');
                completionState[itemKey] = true;
            }
            
            updateProgress(item.closest('.goal'));
            saveGoals();
        }

        // Update progress for a specific goal
        function updateProgress(goalEl) {
            const items = goalEl.querySelectorAll('.goal-item');
            const completed = goalEl.querySelectorAll('.goal-item.completed');
            const percentage = (completed.length / items.length) * 100;
            
            const progressFill = goalEl.querySelector('.progress-fill');
            const progressText = goalEl.querySelector('.progress-text');
            
            progressFill.style.width = percentage + '%';
            progressText.textContent = `${completed.length} of ${items.length} completed`;
        }

        // Update all progress bars
        function updateAllProgress() {
            document.querySelectorAll('.goal').forEach(updateProgress);
        }

        // Set current week
        function setCurrentWeek() {
            const now = new Date();
            const monday = new Date(now);
            monday.setDate(now.getDate() - now.getDay() + 1);
            const sunday = new Date(monday);
            sunday.setDate(monday.getDate() + 6);
            
            const formatDate = (date) => date.toLocaleDateString('en-US', { month: 'long', day: 'numeric' });
            const weekText = `Week of ${formatDate(monday)} - ${formatDate(sunday)}, ${now.getFullYear()}`;
            
            document.getElementById('weekHeader').textContent = weekText;
        }

        // Initialize
        setCurrentWeek();
        loadGoals();
    </script>
</body>
</html>