<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Residue</title>
    
    <!-- OpenGraph -->
    <meta property="og:title" content="Residue">
    <meta property="og:description" content="Every signal leaves a trace. Every thought leaves residue.">
    <meta property="og:image" content="https://kochi.to/amber/residue-og.png">
    <meta property="og:url" content="https://kochi.to/amber/residue.html">
    <meta property="og:type" content="website">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Residue">
    <meta name="twitter:description" content="Every signal leaves a trace. Every thought leaves residue.">
    <meta name="twitter:image" content="https://kochi.to/amber/residue-og.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            overflow: hidden;
            font-family: 'Space Mono', monospace;
            cursor: crosshair;
        }
        
        canvas {
            display: block;
            width: 100%;
            height: 100vh;
        }
        
        #info {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: #D4A574;
            font-size: 11px;
            text-align: center;
            opacity: 0.4;
            letter-spacing: 2px;
            text-transform: uppercase;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="info">Click to transmit • Watch it fade • Residue accumulates</div>
    
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        let width = canvas.width = window.innerWidth;
        let height = canvas.height = window.innerHeight;
        
        window.addEventListener('resize', () => {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        });
        
        class Signal {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.amplitude = 80 + Math.random() * 40;
                this.frequency = 0.02 + Math.random() * 0.03;
                this.phase = Math.random() * Math.PI * 2;
                this.decay = 0.98;
                this.alpha = 1.0;
                this.width = 300 + Math.random() * 200;
                this.speed = 0.05 + Math.random() * 0.03;
            }
            
            update() {
                this.phase += this.speed;
                this.alpha *= this.decay;
                return this.alpha > 0.01;
            }
            
            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.strokeStyle = `rgba(212, 165, 116, ${this.alpha})`;
                ctx.lineWidth = 2;
                ctx.shadowBlur = 15;
                ctx.shadowColor = '#D4A574';
                
                ctx.beginPath();
                for (let i = -this.width / 2; i < this.width / 2; i += 2) {
                    const x = this.x + i;
                    const offset = i / 50;
                    const y = this.y + Math.sin(i * this.frequency + this.phase + offset) * this.amplitude * this.alpha;
                    
                    if (i === -this.width / 2) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.stroke();
                ctx.restore();
            }
        }
        
        class Residue {
            constructor() {
                this.layers = [];
                this.maxLayers = 30;
            }
            
            add(imageData) {
                this.layers.push({
                    data: imageData,
                    alpha: 0.15
                });
                
                if (this.layers.length > this.maxLayers) {
                    this.layers.shift();
                }
            }
            
            draw() {
                this.layers.forEach((layer, i) => {
                    ctx.globalAlpha = layer.alpha * (i / this.layers.length);
                    ctx.putImageData(layer.data, 0, 0);
                });
                ctx.globalAlpha = 1.0;
            }
        }
        
        const signals = [];
        const residue = new Residue();
        let frameCount = 0;
        
        // Initial signals
        for (let i = 0; i < 3; i++) {
            setTimeout(() => {
                signals.push(new Signal(
                    width / 2 + (Math.random() - 0.5) * width * 0.6,
                    height / 2 + (Math.random() - 0.5) * height * 0.4
                ));
            }, i * 800);
        }
        
        canvas.addEventListener('click', (e) => {
            signals.push(new Signal(e.clientX, e.clientY));
        });
        
        function animate() {
            // Very slight fade instead of full clear - creates accumulation
            ctx.fillStyle = 'rgba(0, 0, 0, 0.02)';
            ctx.fillRect(0, 0, width, height);
            
            // Update and draw active signals
            for (let i = signals.length - 1; i >= 0; i--) {
                const signal = signals[i];
                if (!signal.update()) {
                    signals.splice(i, 1);
                } else {
                    signal.draw();
                }
            }
            
            // Every 30 frames, capture residue
            frameCount++;
            if (frameCount % 30 === 0 && signals.length > 0) {
                const imageData = ctx.getImageData(0, 0, width, height);
                residue.add(imageData);
            }
            
            // Draw teal grid accent (subtle)
            ctx.strokeStyle = 'rgba(45, 149, 150, 0.03)';
            ctx.lineWidth = 1;
            const gridSize = 50;
            for (let x = 0; x < width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }
            for (let y = 0; y < height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            requestAnimationFrame(animate);
        }
        
        animate();
    </script>
</body>
</html>