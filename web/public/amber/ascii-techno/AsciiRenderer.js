const { useState, useEffect, useRef } = React;

function AsciiRenderer({ beatCount, kickHit }) {
    const [frame, setFrame] = useState(0);
    const [pulse, setPulse] = useState(false);
    const [bassHit, setBassHit] = useState(false);

    useEffect(() => {
        const interval = setInterval(() => {
            setFrame(f => (f + 1) % 8);
        }, 125); // 8 frames per second for smooth animation

        return () => clearInterval(interval);
    }, []);

    useEffect(() => {
        if (beatCount > 0) {
            setPulse(true);
            setTimeout(() => setPulse(false), 500);
        }
    }, [beatCount]);

    useEffect(() => {
        if (kickHit) {
            setBassHit(true);
            setTimeout(() => setBassHit(false), 150);
        }
    }, [kickHit]);

    // Generate different ASCII patterns based on frame
    const generateAscii = () => {
        const patterns = [
            // Pattern 1: Expanding waves
            `
    ╔═══════════════════════════════════╗
    ║    ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓    ║
    ║   ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒   ║
    ║  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  ║
    ║ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ ║
    ║ ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒ ║
    ║ ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ ║
    ║ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ ║
    ║  ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒  ║
    ║   ░░░░░░░░░░░░░░░░░░░░░░░░░░░   ║
    ║    ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓    ║
    ╚═══════════════════════════════════╝
            `,
            // Pattern 2: Vertical bars
            `
    ╔═══════════════════════════════════╗
    ║ ║║║║║║║║║║║║║║║║║║║║║║║║║║║║║║║║║ ║
    ║ ▓▓▓▓  ▒▒▒▒  ░░░░  ▓▓▓▓  ▒▒▒▒  ░░ ║
    ║ ▓▓▓▓  ▒▒▒▒  ░░░░  ▓▓▓▓  ▒▒▒▒  ░░ ║
    ║ ▓▓▓▓  ▒▒▒▒  ░░░░  ▓▓▓▓  ▒▒▒▒  ░░ ║
    ║ ▓▓▓▓  ▒▒▒▒  ░░░░  ▓▓▓▓  ▒▒▒▒  ░░ ║
    ║ ▓▓▓▓  ▒▒▒▒  ░░░░  ▓▓▓▓  ▒▒▒▒  ░░ ║
    ║ ▓▓▓▓  ▒▒▒▒  ░░░░  ▓▓▓▓  ▒▒▒▒  ░░ ║
    ║ ▓▓▓▓  ▒▒▒▒  ░░░░  ▓▓▓▓  ▒▒▒▒  ░░ ║
    ║ ▓▓▓▓  ▒▒▒▒  ░░░░  ▓▓▓▓  ▒▒▒▒  ░░ ║
    ║ ▓▓▓▓  ▒▒▒▒  ░░░░  ▓▓▓▓  ▒▒▒▒  ░░ ║
    ║ ║║║║║║║║║║║║║║║║║║║║║║║║║║║║║║║║║ ║
    ╚═══════════════════════════════════╝
            `,
            // Pattern 3: Grid pulse
            `
    ╔═══════════════════════════════════╗
    ║   ▓ ░ ▒ ▓ ░ ▒ ▓ ░ ▒ ▓ ░ ▒ ▓ ░   ║
    ║   ░ ▒ ▓ ░ ▒ ▓ ░ ▒ ▓ ░ ▒ ▓ ░ ▒   ║
    ║   ▒ ▓ ░ ▒ ▓ ░ ▒ ▓ ░ ▒ ▓ ░ ▒ ▓   ║
    ║   ▓ ░ ▒ ▓ ░ ▒ ▓ ░ ▒ ▓ ░ ▒ ▓ ░   ║
    ║   ░ ▒ ▓ ░ ▒ ▓ ░ ▒ ▓ ░ ▒ ▓ ░ ▒   ║
    ║   ▒ ▓ ░ ▒ ▓ ░ ▒ ▓ ░ ▒ ▓ ░ ▒ ▓   ║
    ║   ▓ ░ ▒ ▓ ░ ▒ ▓ ░ ▒ ▓ ░ ▒ ▓ ░   ║
    ║   ░ ▒ ▓ ░ ▒ ▓ ░ ▒ ▓ ░ ▒ ▓ ░ ▒   ║
    ║   ▒ ▓ ░ ▒ ▓ ░ ▒ ▓ ░ ▒ ▓ ░ ▒ ▓   ║
    ║   ▓ ░ ▒ ▓ ░ ▒ ▓ ░ ▒ ▓ ░ ▒ ▓ ░   ║
    ║   ░ ▒ ▓ ░ ▒ ▓ ░ ▒ ▓ ░ ▒ ▓ ░ ▒   ║
    ╚═══════════════════════════════════╝
            `,
            // Pattern 4: Spiral
            `
    ╔═══════════════════════════════════╗
    ║   ░░░░░▒▒▒▒▒▓▓▓▓▓▒▒▒▒▒░░░░░      ║
    ║  ░░░░▒▒▒▒▒▓▓▓▓▓███▓▓▓▓▓▒▒▒▒░░░   ║
    ║ ░░░▒▒▒▒▓▓▓▓▓███████▓▓▓▓▓▒▒▒░░░  ║
    ║ ░░▒▒▒▓▓▓▓███████████▓▓▓▓▒▒▒░░  ║
    ║ ░▒▒▒▓▓▓███████████████▓▓▓▒▒▒░  ║
    ║ ░▒▒▓▓▓███████████████▓▓▓▒▒▒░   ║
    ║ ░░▒▒▓▓▓▓███████████▓▓▓▓▒▒░░░   ║
    ║  ░░▒▒▒▓▓▓▓▓███████▓▓▓▓▒▒▒░░░   ║
    ║   ░░░▒▒▒▒▓▓▓▓▓███▓▓▓▓▒▒▒░░░    ║
    ║    ░░░░▒▒▒▒▒▓▓▓▓▓▒▒▒▒░░░░      ║
    ║      ░░░░░▒▒▒▒▒▒▒▒░░░░░        ║
    ╚═══════════════════════════════════╝
            `,
            // Pattern 5: Diamond
            `
    ╔═══════════════════════════════════╗
    ║             ▓▓▓                   ║
    ║           ▓▓▓▓▓▓▓                 ║
    ║         ▓▓▓░░░▓▓▓                ║
    ║       ▓▓▓░░▒▒▒░░▓▓▓              ║
    ║     ▓▓▓░░▒▒███▒▒░░▓▓▓            ║
    ║   ▓▓▓░░▒▒███████▒▒░░▓▓▓          ║
    ║     ▓▓▓░░▒▒███▒▒░░▓▓▓            ║
║       ▓▓▓░░▒▒▒░░▓▓▓              ║
    ║         ▓▓▓░░░▓▓▓                ║
    ║           ▓▓▓▓▓▓▓                 ║
    ║             ▓▓▓                   ║
    ╚═══════════════════════════════════╝
            `,
            // Pattern 6: Horizontal sweep
            `
    ╔═══════════════════════════════════╗
    ║ ════════════════════════════════ ║
    ║ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ ║
    ║ ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒ ║
    ║ ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ ║
    ║ ════════════════════════════════ ║
    ║ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ ║
    ║ ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒ ║
    ║ ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ ║
    ║ ════════════════════════════════ ║
    ║ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ ║
    ║ ════════════════════════════════ ║
    ╚═══════════════════════════════════╝
            `,
            // Pattern 7: Tunnel
            `
    ╔═══════════════════════════════════╗
    ║ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ ║
    ║ ▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓ ║
    ║ ▓▒░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▓ ║
    ║ ▓▒░                         ░▒▓ ║
    ║ ▓▒░       ███████████       ░▒▓ ║
    ║ ▓▒░       ███████████       ░▒▓ ║
    ║ ▓▒░                         ░▒▓ ║
    ║ ▓▒░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▓ ║
    ║ ▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓ ║
    ║ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ ║
    ║                                   ║
    ╚═══════════════════════════════════╝
            `,
            // Pattern 8: Chaos
            `
    ╔═══════════════════════════════════╗
    ║ ░▒▓█ ▓░█▒ █▒▓░ ░▓█▒ ▒█░▓ ▓▒░█  ║
    ║ ▓█░▒ ░▒▓█ ▒█▓░ █░▒▓ ▓░█▒ ░▓▒█  ║
    ║ █▒░▓ ▓█▒░ ░▓█▒ ▒░▓█ █▓▒░ ▒█▓░  ║
    ║ ░▓█▒ ▒░█▓ ▓▒░█ ░█▒▓ ▒▓░█ █░▒▓  ║
    ║ ▒█▓░ █▓░▒ ░█▓▒ ▓▒█░ ░▒▓█ ▓█░▒  ║
    ║ ▓░█▒ ░▒▓█ █░▒▓ ▒█░▓ ▓░█▒ ▒▓█░  ║
    ║ █▒▓░ ▓█░▒ ▒▓█░ ░▓▒█ █▒░▓ ░▒▓█  ║
    ║ ░█▓▒ ▒▓░█ ▓░█▒ █▒▓░ ▒█▓░ █▓▒░  ║
    ║ ▓▒█░ █░▓▒ ░▒█▓ ▓█░▒ ░▓█▒ ▒░█▓  ║
    ║ ▒░▓█ ▓▒█░ █▓▒░ ░█▒▓ █░▒▓ ▓█░▒  ║
    ║ █▓░▒ ░█▒▓ ▒░▓█ ▓▒░█ ▓█▒░ ░▓█▒  ║
    ╚═══════════════════════════════════╝
            `
        ];

        return patterns[frame % patterns.length];
    };

    const className = `ascii-art ${pulse ? 'pulse' : ''} ${bassHit ? 'bass-hit' : ''}`;

    return (
        <div className="ascii-container">
            <pre className={className}>
                {generateAscii()}
            </pre>
        </div>
    );
}

window.AsciiRenderer = AsciiRenderer;