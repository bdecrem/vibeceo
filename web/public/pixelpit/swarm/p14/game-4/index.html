<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Underwater Bubble Pop</title>
<style>
  html,body{margin:0;padding:0;height:100%;overflow:hidden;background:#001f3f;}
  canvas{display:block;width:100%;height:100%;}
  #overlay{
    position:absolute;top:0;left:0;width:100%;height:100%;
    display:flex;align-items:center;justify-content:center;
    background:rgba(0,0,0,0.6);color:#fff;font-size:2em;flex-direction:column;
    visibility:hidden;
  }
  #score{position:absolute;top:10px;left:10px;color:#fff;font-size:1.5em;}
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="score">Score: 0</div>
<div id="overlay"><span id="msg">Game Over</span><br><span style="font-size:0.6em;">Tap to restart</span></div>
<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const scoreEl = document.getElementById('score');
  const overlay = document.getElementById('overlay');
  const msgEl = document.getElementById('msg');
  let width, height;
  function resize(){width=canvas.width=window.innerWidth;height=canvas.height=window.innerHeight;}
  window.addEventListener('resize',resize);resize();

  class Bubble{
    constructor(){this.reset();}
    reset(){
      this.x=Math.random()*width;
      this.y=height+Math.random()*200;
      this.r=20+Math.random()*15;
      this.speed=1+Math.random()*2;
      this.col='rgba(0,150,255,0.7)';
    }
    update(){this.y-=this.speed; if(this.y<-this.r) this.reset();}
    draw(){ctx.beginPath();ctx.arc(this.x,this.y,this.r,0,Math.PI*2);ctx.fillStyle=this.col;ctx.fill();}
  }
  class Obstacle{
    constructor(){this.reset();}
    reset(){
      this.w=30+Math.random()*20;
      this.h=10+Math.random()*10;
      this.x=Math.random()*(width-this.w);
      this.y=-this.h;
      this.speed=2+Math.random()*3;
      this.col='rgba(255,100,0,0.8)';
    }
    update(){this.y+=this.speed; if(this.y>height) this.reset();}
    draw(){ctx.fillStyle=this.col;ctx.fillRect(this.x,this.y,this.w,this.h);}
  }
  const bubbles = Array.from({length:15},()=>new Bubble());
  const obstacles = Array.from({length:5},()=>new Obstacle());
  let score=0;
  let doubleScore=false;let doubleTimer=0;
  let gameOver=false;

  function update(){
    if(gameOver)return;
    ctx.clearRect(0,0,width,height);
    bubbles.forEach(b=>{b.update();b.draw();});
    obstacles.forEach(o=>{o.update();o.draw();if(o.y>height){gameOver=true;overlay.style.visibility='visible';msgEl.textContent='Game Over';}});
    if(doubleScore){doubleTimer--; if(doubleTimer<=0){doubleScore=false;}}
    scoreEl.textContent='Score: '+score;
  }
  function gameLoop(){update();requestAnimationFrame(gameLoop);}
  gameLoop();

  function popAt(x,y){
    if(gameOver)return;
    for(let i=0;i<bubbles.length;i++){
      const b=bubbles[i];
      const dx=x-b.x,dy=y-b.y;
      if(Math.hypot(dx,dy)<=b.r){
        bubbles.splice(i,1);bubbles.push(new Bubble());
        const add=doubleScore?2:1;
        score+=add;
        if(score%20===0){doubleScore=true;doubleTimer=60;}
        return;
      }
    }
  }
  canvas.addEventListener('mousedown',(e)=>popAt(e.offsetX,e.offsetY));
  canvas.addEventListener('touchstart',(e)=>{e.preventDefault();const rect=canvas.getBoundingClientRect();const touch=e.touches[0];popAt(touch.clientX-rect.left,touch.clientY-rect.top);});
  overlay.addEventListener('click',restart);
  overlay.addEventListener('touchstart',restart);
  function restart(){gameOver=false;overlay.style.visibility='hidden';score=0;doubleScore=false;doubleTimer=0;bubbles.forEach(b=>b.reset());obstacles.forEach(o=>o.reset());}
})();
</script>
</body>
</html>