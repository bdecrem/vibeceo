<!DOCTYPE html>
<html><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SWARM T6 - Visual QA Dashboard</title>
<style>
* { box-sizing: border-box; }
body {
  margin: 0; padding: 20px;
  background: #0a0a0f; color: #fff;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  min-height: 100vh;
}
h1 { margin: 0 0 10px; font-size: 24px; color: #00ff88; }
.status { color: #888; margin-bottom: 20px; font-size: 14px; }
.status.generating { color: #ffaa00; }
.status.judging { color: #ff66aa; }
.status.done { color: #00ff88; }
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 15px;
  max-width: 1400px;
}
.card {
  background: #1a1a2e;
  border-radius: 12px;
  padding: 15px;
  border: 2px solid #333;
  transition: all 0.3s ease;
  cursor: default;
  position: relative;
}
.card.pending { opacity: 0.4; }
.card.running {
  border-color: #ffaa00;
  animation: pulse 1s infinite;
}
.card.done { cursor: pointer; }
.card.ship {
  border-color: #00ff88;
  box-shadow: 0 0 20px #00ff8844;
}
.card.needs_work {
  border-color: #ffaa00;
  box-shadow: 0 0 15px #ffaa0033;
}
.card.broken {
  border-color: #ff4444;
  box-shadow: 0 0 15px #ff444433;
}
.card.judging {
  border-color: #ff66aa;
  animation: judgePulse 1.5s infinite;
}
.card:hover { transform: translateY(-3px); }
@keyframes pulse {
  0%, 100% { opacity: 0.6; }
  50% { opacity: 1; }
}
@keyframes judgePulse {
  0%, 100% { border-color: #ff66aa; }
  50% { border-color: #aa44ff; }
}
.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}
.card-name { font-weight: 600; font-size: 13px; }
.card-id { color: #666; font-size: 11px; }
.card-desc { color: #888; font-size: 11px; margin-bottom: 10px; }
.card-status {
  font-size: 10px;
  padding: 3px 6px;
  border-radius: 4px;
  display: inline-block;
  margin-bottom: 8px;
}
.card.pending .card-status { background: #333; color: #666; }
.card.running .card-status { background: #332200; color: #ffaa00; }
.card.done .card-status,
.card.ship .card-status { background: #003322; color: #00ff88; }
.card.needs_work .card-status { background: #332200; color: #ffaa00; }
.card.broken .card-status { background: #330000; color: #ff4444; }
.card.judging .card-status { background: #331133; color: #ff66aa; }
.scores {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 5px;
  margin-top: 8px;
  font-size: 10px;
}
.score-item {
  background: #0f0f1a;
  padding: 4px;
  border-radius: 4px;
  text-align: center;
}
.score-label { color: #666; display: block; }
.score-value { color: #fff; font-weight: 600; font-size: 14px; }
.verdict {
  position: absolute;
  top: 10px;
  right: 10px;
  font-size: 16px;
}
.screenshot-thumb {
  width: 100%;
  height: 80px;
  object-fit: cover;
  border-radius: 6px;
  margin-top: 8px;
  opacity: 0.8;
}
.preview {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.95);
  display: none;
  z-index: 100;
}
.preview.active { display: flex; flex-direction: column; }
.preview-header {
  padding: 15px 20px;
  background: #1a1a2e;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.preview-title { font-weight: 600; }
.preview-close {
  background: #ff4466;
  border: none;
  color: #fff;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
}
.preview iframe {
  flex: 1;
  border: none;
  background: #000;
}
</style>
</head>
<body>
<h1>SWARM T6 ‚Äî Visual QA Dashboard</h1>
<div class="status" id="status">Loading...</div>
<div class="grid" id="grid"></div>

<div class="preview" id="preview">
  <div class="preview-header">
    <span class="preview-title" id="preview-title"></span>
    <button class="preview-close" onclick="closePreview()">Close</button>
  </div>
  <iframe id="preview-iframe"></iframe>
</div>

<script>
const grid = document.getElementById('grid');
const statusEl = document.getElementById('status');
let lastData = null;

function getVerdict(scores) {
  if (!scores) return '';
  const v = scores.verdict?.toUpperCase() || '';
  if (v.includes('SHIP')) return '‚úÖ';
  if (v.includes('BROKEN')) return 'üíÄ';
  if (v.includes('NEEDS')) return '‚ö†Ô∏è';
  return '‚ùì';
}

function getCardClass(agent) {
  if (agent.status === 'pending') return 'pending';
  if (agent.status === 'running') return 'running';
  if (agent.status === 'judging') return 'judging';
  if (agent.scores) {
    const v = agent.scores.verdict?.toUpperCase() || '';
    if (v.includes('SHIP')) return 'ship';
    if (v.includes('BROKEN')) return 'broken';
    if (v.includes('NEEDS')) return 'needs_work';
  }
  return 'done';
}

function render(data) {
  const pending = data.agents.filter(a => a.status === 'pending').length;
  const running = data.agents.filter(a => a.status === 'running').length;
  const done = data.agents.filter(a => a.status === 'done' || a.scores).length;
  const judging = data.agents.filter(a => a.status === 'judging').length;
  const shipped = data.agents.filter(a => a.scores?.verdict?.toUpperCase().includes('SHIP')).length;

  statusEl.className = 'status ' + data.phase;
  if (data.phase === 'done') {
    statusEl.textContent = `‚úì Complete ‚Äî ${shipped} shipped, ${done - shipped} need work`;
  } else if (data.phase === 'judging') {
    statusEl.textContent = `üîç Judging ‚Äî ${done - judging} rated, ${judging} in review...`;
  } else if (running > 0) {
    statusEl.textContent = `‚ü≥ Generating ‚Äî ${done} done, ${running} building, ${pending} pending`;
  } else {
    statusEl.textContent = 'Waiting...';
  }

  grid.innerHTML = data.agents.map(a => `
    <div class="card ${getCardClass(a)}"
         ${a.url ? `onclick="openPreview('${a.name}', '${a.url}')"` : ''}>
      <span class="verdict">${getVerdict(a.scores)}</span>
      <div class="card-header">
        <span class="card-name">${a.name}</span>
        <span class="card-id">#${a.id}</span>
      </div>
      <div class="card-desc">${a.desc}</div>
      <span class="card-status">
        ${a.status === 'pending' ? '‚óã Pending' : ''}
        ${a.status === 'running' ? '‚óê Building...' : ''}
        ${a.status === 'done' && !a.scores ? '‚óè Built' : ''}
        ${a.status === 'judging' ? 'üîç Judging...' : ''}
        ${a.scores ? `‚óè ${a.time}s` : ''}
      </span>
      ${a.scores ? `
        <div class="scores">
          <div class="score-item">
            <span class="score-label">ALIVE</span>
            <span class="score-value">${a.scores.alive}</span>
          </div>
          <div class="score-item">
            <span class="score-label">THEME</span>
            <span class="score-value">${a.scores.theme}</span>
          </div>
          <div class="score-item">
            <span class="score-label">POLISH</span>
            <span class="score-value">${a.scores.polish}</span>
          </div>
        </div>
      ` : ''}
      ${a.screenshot ? `<img class="screenshot-thumb" src="screenshots/${a.screenshot}" />` : ''}
    </div>
  `).join('');
}

function openPreview(name, url) {
  document.getElementById('preview-title').textContent = name;
  document.getElementById('preview-iframe').src = url;
  document.getElementById('preview').classList.add('active');
}

function closePreview() {
  document.getElementById('preview').classList.remove('active');
  document.getElementById('preview-iframe').src = '';
}

document.addEventListener('keydown', e => {
  if (e.key === 'Escape') closePreview();
});

async function poll() {
  try {
    const res = await fetch('status.json?' + Date.now());
    const data = await res.json();
    if (JSON.stringify(data) !== JSON.stringify(lastData)) {
      lastData = data;
      render(data);
    }
  } catch (e) {}
  setTimeout(poll, 500);
}

poll();
</script>
</body></html>