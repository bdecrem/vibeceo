<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Note Drop - Music Catcher</title>
<style>
  *{margin:0;padding:0;box-sizing:border-box}
  body{background:#0a0812;overflow:hidden;touch-action:none;font-family:'Segoe UI',Arial,sans-serif}
  canvas{display:block}
</style>
</head>
<body>
<canvas id="c"></canvas>
<script>
const c=document.getElementById('c'),ctx=c.getContext('2d');
let W,H;
function resize(){W=c.width=innerWidth;H=c.height=innerHeight}
resize();
window.onresize=resize;

// Audio
let audioCtx=null;
function initAudio(){if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();}
function playTone(f,t='triangle',d=0.22){
  if(!audioCtx)return;
  const o=audioCtx.createOscillator(),g=audioCtx.createGain();
  o.connect(g);g.connect(audioCtx.destination);
  o.frequency.value=f;o.type=t;
  g.gain.setValueAtTime(0.2,audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+d);
  o.start();o.stop(audioCtx.currentTime+d);
}
function comboSound(){[523,659,784].forEach((f,i)=>setTimeout(()=>playTone(f,'sine',0.12),i*45));}

// State
let score=0,combo=0,time=0;
let notes=[],particles=[],popups=[],waves=[],trails=[];
let pulse=0,bass=0,shake={x:0,y:0};

const catcher={x:W/2,tx:W/2,w:180,h:80};
const catchY=()=>H-120;

const colors=[
  {fill:'#FF1744',stroke:'#880022',glow:'#FF1744'},
  {fill:'#00E5FF',stroke:'#006688',glow:'#00E5FF'},
  {fill:'#FFEA00',stroke:'#AA8800',glow:'#FFEA00'},
  {fill:'#00E676',stroke:'#006633',glow:'#00E676'},
  {fill:'#E040FB',stroke:'#6600AA',glow:'#E040FB'},
  {fill:'#FF6D00',stroke:'#884400',glow:'#FF6D00'}
];
const freqs=[262,294,330,349,392,440];
const noteTypes=['quarter','eighth','beamed'];

function spawn(){
  const ci=Math.floor(Math.random()*colors.length);
  notes.push({
    x:Math.random()*(W-200)+100,
    y:-120,
    sz:50+Math.random()*15,
    spd:2.3+Math.random()*1+Math.min(score*0.003,1.3),
    rot:(Math.random()-0.5)*0.08,
    rotV:(Math.random()-0.5)*0.008,
    ci,
    type:noteTypes[Math.floor(Math.random()*noteTypes.length)],
    phase:Math.random()*Math.PI*2,
    amp:0.2+Math.random()*0.15
  });
}

// Spawn initial notes
for(let i=0;i<4;i++){
  notes.push({
    x:W*0.2+Math.random()*(W*0.6),
    y:H*0.12+i*H*0.2,
    sz:55+Math.random()*12,
    spd:2.3+Math.random()*0.8,
    rot:(Math.random()-0.5)*0.05,
    rotV:(Math.random()-0.5)*0.005,
    ci:i%colors.length,
    type:noteTypes[i%noteTypes.length],
    phase:Math.random()*Math.PI*2,
    amp:0.18+Math.random()*0.12
  });
}

function burst(x,y,color){
  for(let i=0;i<30;i++){
    const a=Math.PI*2*i/30;
    const s=12+Math.random()*16;
    particles.push({x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s-7,r:18+Math.random()*22,color,alpha:1,decay:0.013,shape:'circle'});
  }
  for(let i=0;i<28;i++){
    particles.push({
      x:x+(Math.random()-0.5)*110,y:y+(Math.random()-0.5)*70,
      vx:(Math.random()-0.5)*12,vy:-10-Math.random()*12,
      r:9+Math.random()*10,color:'#fff',alpha:1,decay:0.02,shape:'star'
    });
  }
  for(let i=0;i<8;i++){
    particles.push({
      x:x+(Math.random()-0.5)*80,y,
      vx:(Math.random()-0.5)*14,vy:-9-Math.random()*10,
      r:30+Math.random()*18,color,alpha:1,decay:0.016,shape:'miniNote',
      rot:Math.random()*Math.PI,rotV:(Math.random()-0.5)*0.2
    });
  }
}

function addWave(x,y){
  for(let i=0;i<6;i++)waves.push({x,y:y-45,r:55,maxR:220+i*60,alpha:1,delay:i*0.018});
}

function addTrail(x,y,color,sz){
  trails.push({x,y,color,sz,alpha:0.65});
}

function popup(x,y,txt,col='#fff',sc=1){popups.push({x,y,txt,alpha:1,vy:-6,sc,col});}

function update(){
  time+=0.016;
  catcher.x+=(catcher.tx-catcher.x)*0.22;
  pulse*=0.76;bass*=0.8;
  shake.x*=0.7;shake.y*=0.7;
  
  trails.forEach(t=>t.alpha*=0.83);
  trails=trails.filter(t=>t.alpha>0.04);
  
  notes.forEach(n=>{
    if(Math.random()<0.4)addTrail(n.x,n.y+n.sz*0.8,colors[n.ci].fill,n.sz*0.5);
    n.y+=n.spd;
    n.rot+=n.rotV;
    n.phase+=0.045;
    n.x+=Math.sin(n.phase)*n.amp;
  });
  
  const cy=catchY();
  notes=notes.filter(n=>{
    if(n.y>cy-70&&n.y<cy+60&&Math.abs(n.x-catcher.x)<catcher.w/2+n.sz*0.25){
      combo++;
      const pts=10*Math.min(combo,15);
      score+=pts;
      pulse=1;bass=1;
      shake.x=(Math.random()-0.5)*25;
      shake.y=-Math.random()*20;
      burst(n.x,n.y,colors[n.ci].fill);
      addWave(catcher.x,cy);
      popup(n.x,n.y-110,'+'+pts);
      if(combo%5===0&&combo>0){popup(catcher.x,cy-150,combo+'Ã— COMBO!','#FFEA00',2.1);comboSound();}
      else playTone(freqs[n.ci],'triangle',0.35);
      return false;
    }
    if(n.y>H+130){combo=0;return false;}
    return true;
  });
  
  particles.forEach(p=>{
    p.x+=p.vx;p.y+=p.vy;p.vy+=0.6;p.vx*=0.91;p.alpha-=p.decay;
    if(p.rotV)p.rot+=p.rotV;
  });
  particles=particles.filter(p=>p.alpha>0);
  
  waves.forEach(w=>{if(w.delay>0){w.delay-=0.016;return;}w.r+=(w.maxR-w.r)*0.09;w.alpha-=0.028;});
  waves=waves.filter(w=>w.alpha>0);
  
  popups.forEach(p=>{p.y+=p.vy;p.vy*=0.82;p.alpha-=0.014;});
  popups=popups.filter(p=>p.alpha>0);
  
  if(Math.random()<0.024+Math.min(score*0.00002,0.009))spawn();
}

// Draw a GRAPHICAL music note (not using fonts)
function drawMusicNote(n){
  const col=colors[n.ci];
  const {x,y,sz,rot,type}=n;
  
  ctx.save();
  ctx.translate(x,y);
  ctx.rotate(rot);
  
  // Glow
  ctx.shadowColor=col.glow;
  ctx.shadowBlur=50;
  
  ctx.fillStyle=col.fill;
  ctx.strokeStyle=col.stroke;
  
  const headW=sz*0.9;
  const headH=sz*0.65;
  const stemH=sz*2.8;
  const stemX=headW*0.5;
  
  if(type==='quarter'){
    // Filled note head
    ctx.lineWidth=7;
    ctx.beginPath();
    ctx.ellipse(0,0,headW,headH,-0.45,0,Math.PI*2);
    ctx.fill();
    ctx.stroke();
    
    // Stem
    ctx.lineWidth=10;
    ctx.lineCap='round';
    ctx.beginPath();
    ctx.moveTo(stemX,-headH*0.15);
    ctx.lineTo(stemX,-stemH);
    ctx.stroke();
    
    // Highlight
    ctx.shadowBlur=0;
    ctx.fillStyle='rgba(255,255,255,0.4)';
    ctx.beginPath();
    ctx.ellipse(-headW*0.3,-headH*0.2,headW*0.35,headH*0.25,-0.45,0,Math.PI*2);
    ctx.fill();
  }
  else if(type==='eighth'){
    // Note head
    ctx.lineWidth=7;
    ctx.beginPath();
    ctx.ellipse(0,0,headW,headH,-0.45,0,Math.PI*2);
    ctx.fill();
    ctx.stroke();
    
    // Stem
    ctx.lineWidth=10;
    ctx.lineCap='round';
    ctx.beginPath();
    ctx.moveTo(stemX,-headH*0.15);
    ctx.lineTo(stemX,-stemH);
    ctx.stroke();
    
    // Flag - thick and curved
    ctx.lineWidth=8;
    ctx.beginPath();
    ctx.moveTo(stemX,-stemH);
    ctx.bezierCurveTo(stemX+sz*1.8,-stemH+sz*0.6,stemX+sz*1.5,-stemH+sz*1.6,stemX+sz*0.2,-stemH+sz*2.2);
    ctx.stroke();
    
    ctx.fillStyle=col.fill;
    ctx.beginPath();
    ctx.moveTo(stemX,-stemH);
    ctx.bezierCurveTo(stemX+sz*1.8,-stemH+sz*0.6,stemX+sz*1.5,-stemH+sz*1.6,stemX+sz*0.2,-stemH+sz*2.2);
    ctx.lineTo(stemX+sz*0.15,-stemH+sz*1.8);
    ctx.bezierCurveTo(stemX+sz*1.2,-stemH+sz*1.3,stemX+sz*1.4,-stemH+sz*0.5,stemX,-stemH);
    ctx.fill();
    
    // Highlight
    ctx.shadowBlur=0;
    ctx.fillStyle='rgba(255,255,255,0.4)';
    ctx.beginPath();
    ctx.ellipse(-headW*0.3,-headH*0.2,headW*0.35,headH*0.25,-0.45,0,Math.PI*2);
    ctx.fill();
  }
  else if(type==='beamed'){
    const gap=sz*1.5;
    const stemH2=stemH*0.9;
    
    // Left head
    ctx.lineWidth=6;
    ctx.beginPath();
    ctx.ellipse(-gap/2,0,headW*0.8,headH*0.6,-0.45,0,Math.PI*2);
    ctx.fill();
    ctx.stroke();
    
    // Right head
    ctx.beginPath();
    ctx.ellipse(gap/2,0,headW*0.8,headH*0.6,-0.45,0,Math.PI*2);
    ctx.fill();
    ctx.stroke();
    
    // Stems
    ctx.lineWidth=9;
    ctx.lineCap='round';
    ctx.beginPath();
    ctx.moveTo(-gap/2+headW*0.5,-headH*0.1);
    ctx.lineTo(-gap/2+headW*0.5,-stemH2);
    ctx.stroke();
    
    ctx.beginPath();
    ctx.moveTo(gap/2+headW*0.5,-headH*0.1);
    ctx.lineTo(gap/2+headW*0.5,-stemH2);
    ctx.stroke();
    
    // Beam
    ctx.fillStyle=col.fill;
    ctx.strokeStyle=col.stroke;
    ctx.lineWidth=4;
    ctx.beginPath();
    ctx.rect(-gap/2+headW*0.5-4,-stemH2-10,gap+8,20);
    ctx.fill();
    ctx.stroke();
  }
  
  ctx.restore();
}

function drawCatcher(){
  const x=catcher.x,y=catchY();
  const w=catcher.w+pulse*60,h=catcher.h+pulse*35;
  
  ctx.save();
  
  if(pulse>0.03){
    ctx.shadowColor='#00E676';
    ctx.shadowBlur=110*pulse;
  }
  
  // Catch zone
  ctx.fillStyle=`rgba(0,230,118,${0.03+pulse*0.4})`;
  ctx.beginPath();
  ctx.ellipse(x,y-40,w*1.2,65,0,0,Math.PI*2);
  ctx.fill();
  
  // Speaker cabinet
  const cab=ctx.createLinearGradient(x-w/2,y-h/2,x-w/2,y+h/2+45);
  cab.addColorStop(0,'#6868a0');
  cab.addColorStop(0.4,'#545480');
  cab.addColorStop(1,'#444468');
  
  ctx.fillStyle=cab;
  ctx.strokeStyle='#8080b0';
  ctx.lineWidth=16;
  ctx.beginPath();
  ctx.roundRect(x-w/2,y-h/2,w,h+45,28);
  ctx.fill();
  ctx.stroke();
  
  ctx.strokeStyle='#303050';
  ctx.lineWidth=8;
  ctx.beginPath();
  ctx.roundRect(x-w/2+22,y-h/2+22,w-44,h+4,22);
  ctx.stroke();
  
  // Cone
  const cr=h*1.05+pulse*32+bass*18;
  const cone=ctx.createRadialGradient(x,y,cr*0.02,x,y,cr);
  cone.addColorStop(0,'#9898c0');
  cone.addColorStop(0.26,'#7878a0');
  cone.addColorStop(0.6,'#606088');
  cone.addColorStop(1,'#4a4a70');
  
  ctx.fillStyle=cone;
  ctx.strokeStyle='#7a7aa0';
  ctx.lineWidth=12;
  ctx.beginPath();
  ctx.arc(x,y,cr,0,Math.PI*2);
  ctx.fill();
  ctx.stroke();
  
  ctx.strokeStyle='#606088';
  ctx.lineWidth=3;
  [0.24,0.44,0.64].forEach(r=>{ctx.beginPath();ctx.arc(x,y,cr*r,0,Math.PI*2);ctx.stroke();});
  
  // Dome
  const dr=cr*0.32+pulse*20+bass*14;
  const dome=ctx.createRadialGradient(x-10,y-10,0,x,y,dr);
  dome.addColorStop(0,'#e0e0f8');
  dome.addColorStop(0.5,'#9898b8');
  dome.addColorStop(1,'#707098');
  
  ctx.fillStyle=dome;
  ctx.strokeStyle='#8888a8';
  ctx.lineWidth=8;
  ctx.beginPath();
  ctx.arc(x,y,dr,0,Math.PI*2);
  ctx.fill();
  ctx.stroke();
  
  // Sound waves
  waves.forEach(w=>{
    if(w.delay>0)return;
    ctx.strokeStyle=`rgba(0,230,118,${w.alpha})`;
    ctx.lineWidth=10;
    ctx.beginPath();
    ctx.arc(w.x,w.y,w.r,Math.PI*1.0,Math.PI*2);
    ctx.stroke();
  });
  
  ctx.restore();
}

function drawBG(){
  const bg=ctx.createLinearGradient(0,0,0,H);
  bg.addColorStop(0,'#241c48');
  bg.addColorStop(0.5,'#1a122c');
  bg.addColorStop(1,'#120c18');
  ctx.fillStyle=bg;
  ctx.fillRect(-30,-30,W+60,H+60);
  
  // Staff lines
  ctx.strokeStyle='rgba(170,160,220,0.05)';
  ctx.lineWidth=2;
  const gap=42,scrollOff=(time*60)%(gap*6);
  for(let g=-1;g<Math.ceil(H/(gap*6))+2;g++){
    for(let i=0;i<5;i++){
      const lineY=g*gap*6+i*gap+scrollOff;
      ctx.beginPath();ctx.moveTo(0,lineY);ctx.lineTo(W,lineY);ctx.stroke();
    }
  }
  
  // Treble clefs
  ctx.globalAlpha=0.03;
  ctx.font='220px serif';
  ctx.fillStyle='#a0a0c0';
  ctx.fillText('ð„ž',W*0.06,H*0.36);
  ctx.fillText('ð„ž',W*0.76,H*0.56);
  ctx.globalAlpha=1;
  
  // EQ bars
  ctx.globalAlpha=0.3;
  const bars=40,bw=W/bars-2;
  for(let i=0;i<bars;i++){
    const bx=i*(W/bars)+1;
    const w1=Math.sin(time*6+i*0.75)*0.5+0.5;
    const w2=Math.sin(time*4+i*1.1)*0.4+0.6;
    const bh=35+w1*w2*85+bass*70;
    ctx.fillStyle=colors[i%colors.length].fill;
    ctx.fillRect(bx,H-bh,bw,bh);
  }
  ctx.globalAlpha=1;
  
  // Spotlight
  const spot=ctx.createRadialGradient(W/2,-200,0,W/2,H*0.5,H);
  spot.addColorStop(0,'rgba(150,130,255,0.26)');
  spot.addColorStop(1,'rgba(0,0,0,0)');
  ctx.fillStyle=spot;
  ctx.fillRect(0,0,W,H);
}

function drawTrails(){
  trails.forEach(t=>{
    ctx.globalAlpha=t.alpha;
    ctx.fillStyle=t.color;
    ctx.beginPath();
    ctx.arc(t.x,t.y,t.sz*t.alpha,0,Math.PI*2);
    ctx.fill();
  });
  ctx.globalAlpha=1;
}

function drawParticle(p){
  ctx.globalAlpha=p.alpha;
  if(p.shape==='circle'){
    ctx.fillStyle=p.color;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r*p.alpha,0,Math.PI*2);
    ctx.fill();
  }else if(p.shape==='star'){
    ctx.fillStyle=p.color;
    const s=p.r*p.alpha;
    ctx.beginPath();
    for(let i=0;i<4;i++){
      const a=Math.PI/2*i;
      ctx.lineTo(p.x+Math.cos(a)*s,p.y+Math.sin(a)*s);
      ctx.lineTo(p.x+Math.cos(a+Math.PI/4)*s*0.18,p.y+Math.sin(a+Math.PI/4)*s*0.18);
    }
    ctx.closePath();ctx.fill();
  }else if(p.shape==='miniNote'){
    ctx.save();
    ctx.translate(p.x,p.y);
    ctx.rotate(p.rot);
    ctx.fillStyle=p.color;
    const s=p.r*p.alpha;
    ctx.beginPath();
    ctx.ellipse(0,0,s*0.5,s*0.35,-0.45,0,Math.PI*2);
    ctx.fill();
    ctx.lineWidth=s*0.15;
    ctx.strokeStyle=p.color;
    ctx.beginPath();
    ctx.moveTo(s*0.3,-s*0.1);
    ctx.lineTo(s*0.3,-s);
    ctx.stroke();
    ctx.restore();
  }
  ctx.globalAlpha=1;
}

function drawUI(){
  ctx.fillStyle='rgba(35,32,68,0.95)';
  ctx.strokeStyle='#7070a8';
  ctx.lineWidth=8;
  ctx.beginPath();
  ctx.roundRect(30,30,230,110,26);
  ctx.fill();ctx.stroke();
  
  ctx.fillStyle='#fff';
  ctx.font='34px serif';
  ctx.fillText('â™ª',55,80);
  
  ctx.fillStyle='#fff';
  ctx.font='bold 17px "Segoe UI",Arial,sans-serif';
  ctx.textAlign='left';
  ctx.fillText('SCORE',98,78);
  
  ctx.fillStyle='#FFEA00';
  ctx.font='bold 62px "Segoe UI",Arial,sans-serif';
  ctx.fillText(score.toString(),55,130);
  
  if(combo>1){
    ctx.fillStyle='#00E676';
    ctx.font='bold 34px "Segoe UI",Arial,sans-serif';
    ctx.textAlign='right';
    ctx.fillText('Ã—'+combo,248,126);
    ctx.textAlign='left';
  }
  
  popups.forEach(p=>{
    ctx.globalAlpha=p.alpha;
    ctx.fillStyle=p.col;
    ctx.textAlign='center';
    ctx.font=`bold ${36*p.sc}px "Segoe UI",Arial,sans-serif`;
    ctx.shadowColor=p.col;
    ctx.shadowBlur=35;
    ctx.fillText(p.txt,p.x,p.y);
    ctx.shadowBlur=0;
  });
  ctx.globalAlpha=1;
  ctx.textAlign='left';
}

function draw(){
  ctx.save();
  ctx.translate(shake.x,shake.y);
  drawBG();
  drawTrails();
  particles.forEach(drawParticle);
  notes.forEach(drawMusicNote);
  drawCatcher();
  ctx.restore();
  drawUI();
}

function setTgt(px){
  initAudio();
  catcher.tx=Math.max(catcher.w/2+45,Math.min(W-catcher.w/2-45,px));
}

c.addEventListener('mousemove',e=>setTgt(e.clientX));
c.addEventListener('mousedown',e=>{initAudio();setTgt(e.clientX);});
c.addEventListener('touchstart',e=>{e.preventDefault();initAudio();setTgt(e.touches[0].clientX);},{passive:false});
c.addEventListener('touchmove',e=>{e.preventDefault();setTgt(e.touches[0].clientX);},{passive:false});

(function loop(){update();draw();requestAnimationFrame(loop);})();
</script>
</body>
</html>