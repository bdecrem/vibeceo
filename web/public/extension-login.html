<!DOCTYPE html>
<html>
<head>
    <title>Safari Extension Login - WEBTOYS Superpower Mode</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 500px;
            width: 100%;
            padding: 40px;
        }
        
        h1 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 28px;
            text-align: center;
        }
        
        .subtitle {
            color: #718096;
            text-align: center;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            color: #4a5568;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }
        
        input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            display: none;
        }
        
        .status.success {
            background: #c6f6d5;
            color: #22543d;
            border: 2px solid #9ae6b4;
            display: block;
        }
        
        .status.error {
            background: #fed7d7;
            color: #742a2a;
            border: 2px solid #fc8181;
            display: block;
        }
        
        .status.info {
            background: #bee3f8;
            color: #2c5282;
            border: 2px solid #90cdf4;
            display: block;
        }
        
        .divider {
            text-align: center;
            margin: 20px 0;
            color: #a0aec0;
            position: relative;
        }
        
        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #e2e8f0;
        }
        
        .divider span {
            background: white;
            padding: 0 15px;
            position: relative;
        }
        
        .instructions {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .instructions h3 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .instructions ol {
            color: #4a5568;
            margin-left: 20px;
            line-height: 1.8;
        }
        
        .instructions code {
            background: #edf2f7;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 13px;
        }
        
        .auth-info {
            background: #f0fff4;
            border: 2px solid #9ae6b4;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            display: none;
        }
        
        .auth-info.show {
            display: block;
        }
        
        .auth-info h4 {
            color: #22543d;
            margin-bottom: 10px;
        }
        
        .auth-info .token-display {
            background: white;
            border: 1px solid #c6f6d5;
            border-radius: 5px;
            padding: 10px;
            word-break: break-all;
            font-family: monospace;
            font-size: 12px;
            margin: 5px 0;
        }
        
        .emoji {
            font-size: 24px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê Safari Extension Login</h1>
        <p class="subtitle">Authenticate to enable WEBTOYS Superpower Mode</p>
        
        <div id="loginForm">
            <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" placeholder="you@example.com" required>
            </div>
            
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Your password" required>
            </div>
            
            <button id="loginBtn" onclick="handleLogin()">
                Sign In with Supabase
            </button>
            
            <div class="divider">
                <span>OR</span>
            </div>
            
            <button id="manualBtn" onclick="showManualSetup()">
                Manual Token Setup
            </button>
        </div>
        
        <div id="manualSetup" style="display: none;">
            <div class="form-group">
                <label for="authToken">Auth Token</label>
                <input type="text" id="authToken" placeholder="M2a/gemOStrxNhh4fygtZuEBdTbDmO68s35IrFO5ay0=">
            </div>
            
            <div class="form-group">
                <label for="apiUrl">API URL</label>
                <input type="text" id="apiUrl" value="http://localhost:3000" placeholder="http://localhost:3000">
            </div>
            
            <button onclick="setManualAuth()">Set Authentication</button>
            <button onclick="hideManualSetup()" style="background: #718096;">Cancel</button>
        </div>
        
        <div id="status" class="status"></div>
        
        <div id="authInfo" class="auth-info">
            <h4>‚úÖ Authentication Set!</h4>
            <div>
                <strong>Token:</strong>
                <div class="token-display" id="tokenDisplay"></div>
            </div>
            <div>
                <strong>API URL:</strong>
                <div class="token-display" id="urlDisplay"></div>
            </div>
        </div>
        
        <div class="instructions">
            <h3>üìù How to Use:</h3>
            <ol>
                <li>Sign in with your Supabase account above</li>
                <li>Once authenticated, the extension will have access</li>
                <li>Open your Safari Extension and enter:
                    <ul style="margin-top: 5px;">
                        <li>API URL: <code id="apiUrlDisplay">http://localhost:3000</code></li>
                        <li>Auth Token: <code>(will be shown after login)</code></li>
                    </ul>
                </li>
                <li>Click "Test Connection" in the extension</li>
                <li>Visit any issue tracker with <code>?superpower=true</code></li>
            </ol>
        </div>
    </div>
    
    <script>
        // Configuration
        const SUPABASE_URL = 'https://glvlqzuihnmsfakbplnt.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdsdmxxenVpaG5tc2Zha2JwbG50Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTMwMDI2NjgsImV4cCI6MjAyODU3ODY2OH0.PilwZa70VzQzT1cH5pjCvzJtQwBMGqFQiUvemkrAzeQ';
        const SERVICE_TOKEN = 'M2a/gemOStrxNhh4fygtZuEBdTbDmO68s35IrFO5ay0='; // The extension token
        
        // Check existing auth on load
        window.addEventListener('DOMContentLoaded', () => {
            checkExistingAuth();
            
            // Set API URL based on current location
            const apiUrl = window.location.hostname === 'localhost' 
                ? `http://localhost:${window.location.port || '3000'}`
                : 'https://webtoys.ai';
            document.getElementById('apiUrl').value = apiUrl;
            document.getElementById('apiUrlDisplay').textContent = apiUrl;
        });
        
        function checkExistingAuth() {
            const token = localStorage.getItem('webtoysAuthToken');
            const url = localStorage.getItem('webtoysApiUrl');
            
            if (token && url) {
                showStatus('Already authenticated! Extension should work.', 'success');
                document.getElementById('tokenDisplay').textContent = token;
                document.getElementById('urlDisplay').textContent = url;
                document.getElementById('authInfo').classList.add('show');
            }
        }
        
        async function handleLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                showStatus('Please enter email and password', 'error');
                return;
            }
            
            document.getElementById('loginBtn').disabled = true;
            showStatus('Signing in...', 'info');
            
            try {
                // For now, we'll use the manual token approach
                // In production, you'd make a proper Supabase auth call here
                
                // Simulate successful login and set the service token
                const apiUrl = document.getElementById('apiUrl').value || 
                              (window.location.hostname === 'localhost' 
                                ? `http://localhost:${window.location.port || '3000'}`
                                : 'https://webtoys.ai');
                
                // Set the auth in localStorage for the extension to use
                localStorage.setItem('webtoysAuthToken', `Bearer ${SERVICE_TOKEN}`);
                localStorage.setItem('webtoysApiUrl', apiUrl);
                
                showStatus('‚úÖ Authentication successful! Extension is now authorized.', 'success');
                
                // Show auth info
                document.getElementById('tokenDisplay').textContent = `Bearer ${SERVICE_TOKEN}`;
                document.getElementById('urlDisplay').textContent = apiUrl;
                document.getElementById('authInfo').classList.add('show');
                
                // Offer to open issue tracker
                setTimeout(() => {
                    if (confirm('Authentication complete! Open the Issue Tracker with Superpower Mode?')) {
                        window.open(`${apiUrl}/bart/issue-tracker?superpower=true`, '_blank');
                    }
                }, 1000);
                
            } catch (error) {
                showStatus('Login failed: ' + error.message, 'error');
            } finally {
                document.getElementById('loginBtn').disabled = false;
            }
        }
        
        function showManualSetup() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('manualSetup').style.display = 'block';
        }
        
        function hideManualSetup() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('manualSetup').style.display = 'none';
        }
        
        function setManualAuth() {
            const token = document.getElementById('authToken').value;
            const url = document.getElementById('apiUrl').value;
            
            if (!token || !url) {
                showStatus('Please enter both token and URL', 'error');
                return;
            }
            
            // Set in localStorage
            localStorage.setItem('webtoysAuthToken', `Bearer ${token}`);
            localStorage.setItem('webtoysApiUrl', url);
            
            showStatus('‚úÖ Manual authentication set! Extension should now work.', 'success');
            
            // Show auth info
            document.getElementById('tokenDisplay').textContent = `Bearer ${token}`;
            document.getElementById('urlDisplay').textContent = url;
            document.getElementById('authInfo').classList.add('show');
            
            hideManualSetup();
        }
        
        function showStatus(message, type) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = 'status ' + type;
        }
    </script>
</body>
</html>