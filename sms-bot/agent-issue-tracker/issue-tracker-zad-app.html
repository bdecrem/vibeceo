<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WEBTOYS Issue Tracker</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        :root {
            /* WEBTOYS BRAND COLORS - BOLD AND CONFIDENT */
            --cream: #fefdf8;
            --cream-dark: #f8f6f0;
            --charcoal: #2d3748;
            --charcoal-light: #4a5568;
            
            /* HERO RED BRAND COLOR */
            --webtoys-red: #ff3333;
            --webtoys-red-glow: rgba(255, 51, 51, 0.4);
            --webtoys-red-light: #ffe6e6;
            
            /* NEON RED FOR TEXT SHADOW */
            --red: #FF4B4B;
            
            /* PUNCHY ACCENT COLORS */
            --electric-blue: #00aaff;
            --electric-blue-light: #e6f7ff;
            --hot-pink: #ff1493;
            --hot-pink-light: #ffe6f4;
            --lime-green: #32cd32;
            --lime-green-light: #f0fff0;
            --sunshine-yellow: #ffd700;
            --sunshine-yellow-light: #fffacd;
            --purple-magic: #8a2be2;
            --orange-blast: #ff6347;
            
            /* BOLD GRADIENTS */
            --hero-gradient: linear-gradient(135deg, var(--webtoys-red) 0%, #ff6b6b 100%);
            --button-gradient: linear-gradient(135deg, var(--electric-blue) 0%, #0088cc 100%);
            --card-gradient: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.85) 100%);
            
            /* LEGACY COMPATIBILITY */
            --yellow: #FFD63D;
            --blue: #6ECBFF;
            --green-mint: #B6FFB3;
            --purple-shadow: #C9C2F9;
            --yellow-soft: #FFF4CC;
            --blue-deep: #4A9FD4;
            --red-soft: #FF7A7A;
            --purple-accent: #8B7FD4;
            --green-sage: #7FB069;
            --gray-warm: #6B6B6B;
            
            /* SPACING */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;
            --space-3xl: 64px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            overflow-x: hidden;
            width: 100%;
        }

        /* PLAYFUL FLOATING EMOJIS WITH PERSONALITY */
        @keyframes playfulFloat {
            0%, 100% { 
                transform: translateY(0px) scale(1); 
                opacity: 0.35; 
            }
            33% { 
                transform: translateY(-20px) scale(1.1); 
                opacity: 0.5; 
            }
            66% { 
                transform: translateY(-10px) scale(0.9); 
                opacity: 0.4; 
            }
        }

        @keyframes heroGlow {
            0%, 100% { 
                filter: drop-shadow(0 4px 16px var(--webtoys-red-glow));
                transform: scale(1);
            }
            50% { 
                filter: drop-shadow(0 8px 24px var(--webtoys-red-glow));
                transform: scale(1.02);
            }
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--cream);
            background-image: 
                radial-gradient(circle at 85% 15%, rgba(255, 51, 51, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 20% 80%, rgba(0, 170, 255, 0.06) 0%, transparent 50%),
                radial-gradient(circle at 50% 40%, rgba(255, 20, 147, 0.04) 0%, transparent 50%);
            min-height: 100vh;
            padding: var(--space-md);
            line-height: 1.6;
            color: var(--charcoal);
            overflow-x: hidden;
            position: relative;
            width: 100%;
            max-width: 100vw;
        }

        /* FLOATING EMOJIS - SUBTLE BACKGROUND DECORATION */
        @media (min-width: 769px) {
            body::before {
                content: 'üöÄ';
                position: fixed;
                top: 15%;
                left: 10%;
                pointer-events: none;
                z-index: 1;
                font-size: clamp(1.2rem, 2.5vw, 2rem);
                animation: playfulFloat 8s ease-in-out infinite;
                opacity: 0.3;
            }
            
            body::after {
                content: 'üîß';
                position: fixed;
                top: 25%;
                right: 8%;
                pointer-events: none;
                z-index: 1;
                font-size: clamp(1.1rem, 2.2vw, 1.8rem);
                animation: playfulFloat 10s ease-in-out infinite 2s;
                opacity: 0.25;
            }
            
            .container::before {
                content: '‚ú®';
                position: fixed;
                bottom: 30%;
                left: 5%;
                pointer-events: none;
                z-index: 1;
                font-size: clamp(1rem, 2vw, 1.6rem);
                animation: playfulFloat 12s ease-in-out infinite 4s;
                opacity: 0.2;
            }
            
            .container::after {
                content: 'üéÆ';
                position: fixed;
                bottom: 20%;
                right: 12%;
                pointer-events: none;
                z-index: 1;
                font-size: clamp(1.3rem, 2.3vw, 1.9rem);
                animation: playfulFloat 9s ease-in-out infinite 1s;
                opacity: 0.28;
            }
        }

        /* Mobile optimizations */
        /* STATUS INDICATORS */
        .superpower-indicator {
            margin-top: var(--space-lg);
            padding: var(--space-lg) var(--space-xl);
            background: var(--button-gradient);
            border: 2px solid var(--electric-blue);
            border-radius: 16px;
            font-weight: 800;
            text-align: center;
            box-shadow: 
                0 8px 24px rgba(0, 170, 255, 0.3),
                0 4px 12px rgba(0, 0, 0, 0.1);
            font-size: 16px;
            color: white;
            text-transform: uppercase;
            letter-spacing: 1px;
            animation: heroGlow 2s ease-in-out infinite;
        }

        .superpower-indicator.not-authenticated {
            background: var(--webtoys-red-light);
            border-color: var(--webtoys-red);
            color: var(--webtoys-red);
            animation: none;
        }

        /* MOBILE RESPONSIVE */
        @media (max-width: 768px) {
            html, body {
                overflow-x: hidden !important;
                width: 100% !important;
                max-width: 100% !important;
            }
            
            body {
                padding: 8px;
                margin: 0;
            }
            
            .container {
                width: 100%;
                max-width: 100%;
                padding: 0;
                margin: 0;
            }
            
            header {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }
            
            .webtoys-logo-img {
                height: 120px;
            }
            
            h1 {
                font-size: clamp(2rem, 8vw, 3rem);
            }
            
            h2 {
                font-size: clamp(1.3rem, 4vw, 1.8rem);
            }
            
            .webtoys-logo-img {
                height: 180px;
            }
            
            header {
                flex-direction: column;
                text-align: center;
            }
            
            .title-section {
                width: 100%;
            }
            
            button {
                padding: 14px 28px;
                font-size: 15px;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .vibecoding-tagline {
                font-size: 0.85rem;
            }
            
            .container {
                max-width: 100%;
                margin: 0;
            }
            
            .card {
                padding: var(--space-lg);
                margin-bottom: var(--space-lg);
            }
            
            .issue-item {
                padding: var(--space-lg);
            }
            
            .badge {
                padding: 4px 8px;
                font-size: 0.75rem;
                margin: 2px;
            }
            
            .status-timeline {
                flex-wrap: wrap;
                gap: 4px;
            }
            
            .status-step {
                padding: 4px 8px;
                font-size: 0.7rem;
            }
            
            .reaction-btn {
                padding: 6px 10px;
                font-size: 12px;
                margin: 2px;
            }
            
            .issue-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .issue-meta {
                flex-wrap: wrap;
                gap: 5px;
                font-size: 0.8rem;
            }
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
        }

        /* FLOATING HEADER ELEMENTS */
        header {
            color: var(--charcoal);
            margin-bottom: var(--space-3xl);
            position: relative;
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--space-xl);
            padding: var(--space-xl) 0;
        }

        .logo-title-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .logo-wrapper {
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            animation: bounceIn 0.8s ease-out;
        }
        
        .title-section {
            flex: 1;
            text-align: center;
            min-width: 300px;
        }
        
        .subtitle-section {
            width: 100%;
            text-align: center;
        }

        .logo-wrapper:hover {
            transform: translateY(-8px) scale(1.05);
        }

        /* HERO LOGO - CLEAN AND BOLD */
        .webtoys-logo-img {
            height: 280px;
            width: auto;
            transition: all 0.4s ease;
            filter: brightness(1.05) saturate(1.1);
        }

        .webtoys-logo-img:hover {
            transform: scale(1.05);
            filter: brightness(1.1) saturate(1.2);
        }

        @keyframes bounceIn {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .logo-wrapper {
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            animation: bounceIn 0.8s ease-out;
        }
        
        .logo-wrapper:hover {
            transform: translateY(-8px) scale(1.05);
        }

        .webtoys-logo-img {
            height: 280px;
            width: auto;
            transition: all 0.4s ease;
            filter: brightness(1.05) saturate(1.1);
        }

        .webtoys-logo-img:hover {
            transform: scale(1.05);
            filter: brightness(1.1) saturate(1.2);
        }
        
        .title-section {
            flex: 1;
            text-align: center;
            min-width: 300px;
        }

        /* CLEAN RED HEADLINE - SIMPLE LIKE HOMEPAGE */
        h1 {
            font-size: clamp(2.5rem, 8vw, 6rem);
            font-weight: 800;
            letter-spacing: -2px;
            margin: 0;
            color: var(--red);
            text-transform: uppercase;
            position: relative;
            z-index: 1;
            cursor: pointer;
            transform: rotate(-2deg);
            line-height: 1;
            display: inline-block;
        }

        h1:hover {
            transform: rotate(-1deg) scale(1.02);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: var(--charcoal);
            margin-top: var(--space-md);
            font-weight: 600;
            animation: bounceIn 0.6s ease-out 0.4s both;
        }

        .vibecoding-tagline {
            display: block;
            font-size: 1rem;
            color: var(--electric-blue);
            margin-top: var(--space-sm);
            font-weight: 700;
            animation: bounceIn 0.6s ease-out 0.6s both;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* PUNCHY SECTION HEADERS */
        h2 {
            color: var(--charcoal);
            font-weight: 800;
            font-size: clamp(1.6rem, 3.5vw, 2.2rem);
            margin-bottom: var(--space-xl);
            letter-spacing: -0.02em;
            position: relative;
            /* transform: rotate(-1deg); */
        }

        h2::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 60px;
            height: 4px;
            background: var(--hero-gradient);
            border-radius: 4px;
            /* transform: rotate(2deg); */
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* PLAYFUL CARDS WITH PERSONALITY */
        .card {
            background: var(--card-gradient);
            backdrop-filter: blur(15px);
            border-radius: 24px;
            padding: var(--space-xl);
            margin-bottom: var(--space-xl);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                0 4px 16px rgba(255, 51, 51, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.9);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--hero-gradient);
            border-radius: 24px 24px 0 0;
        }
        
        .card:hover {
            transform: translateY(-8px);
            box-shadow: 
                0 16px 48px rgba(0, 0, 0, 0.15),
                0 8px 24px rgba(255, 51, 51, 0.1);
            border-color: var(--webtoys-red-glow);
        }

        /* REFINED FORM ELEMENTS */
        .form-group {
            margin-bottom: var(--space-xl);
            position: relative;
        }

        label {
            display: block;
            margin-bottom: var(--space-sm);
            font-weight: 700;
            color: var(--charcoal);
            font-size: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input, textarea, select {
            width: 100%;
            padding: 18px 24px;
            border: 3px solid var(--electric-blue-light);
            border-radius: 16px;
            font-size: 16px;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            background: rgba(255, 255, 255, 0.95);
            color: var(--charcoal);
            font-weight: 500;
            font-family: 'Inter', sans-serif;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--electric-blue);
            box-shadow: 
                0 0 0 4px rgba(0, 170, 255, 0.2),
                0 8px 24px rgba(0, 170, 255, 0.15);
            background: rgba(255, 255, 255, 1);
            transform: translateY(-2px) scale(1.01);
        }

        input::placeholder, textarea::placeholder {
            color: rgba(45, 55, 72, 0.5);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
            font-family: 'Inter', sans-serif;
        }

        /* BOLD BUTTONS WITH BOUNCE */
        button {
            background: var(--button-gradient);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 16px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 
                0 8px 24px rgba(0, 170, 255, 0.3),
                0 4px 12px rgba(0, 0, 0, 0.1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        button:hover::before {
            left: 100%;
        }

        button:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 
                0 16px 40px rgba(0, 170, 255, 0.4),
                0 8px 20px rgba(0, 0, 0, 0.15);
        }

        button:active {
            transform: translateY(-1px) scale(0.98);
            animation: bounceIn 0.3s ease-out;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        button:disabled:hover {
            transform: none;
            box-shadow: 0 4px 12px rgba(65, 153, 225, 0.2);
        }

        .issue-list {
            /* Natural flow - no height restrictions or separate scrolling */
        }
        
        /* PAGINATION */
        .pagination-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--space-md);
            margin: var(--space-xl) 0;
        }
        
        .pagination-controls button {
            padding: 8px 16px;
            font-size: 14px;
        }
        
        .pagination-info {
            color: var(--charcoal-light);
            font-weight: 500;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .pagination-controls {
                gap: 8px;
            }
            
            .pagination-controls button {
                padding: 8px 12px;
                font-size: 12px;
                min-width: 60px;
            }
        }

        /* CLEAN ISSUE ITEMS */
        .issue-item {
            padding: var(--space-xl);
            margin-bottom: var(--space-lg);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 1px solid rgba(65, 153, 225, 0.1);
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }
        
        .issue-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--electric-blue);
            border-radius: 12px 0 0 12px;
        }
        
        .issue-item:nth-child(even)::before {
            background: var(--lime-green);
        }
        
        .issue-item:nth-child(3n)::before {
            background: var(--sunshine-yellow);
        }

        .issue-item:hover {
            transform: translateY(-4px);
            border-color: var(--electric-blue);
            box-shadow: 
                0 12px 36px rgba(0, 0, 0, 0.12),
                0 6px 18px rgba(0, 170, 255, 0.15);
        }

        .issue-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .issue-title {
            font-weight: 600;
            color: var(--charcoal);
            font-size: 1.1rem;
            line-height: 1.5;
        }

        .issue-meta {
            display: flex;
            gap: 10px;
            font-size: 0.9rem;
            color: #666;
        }

        /* REFINED BADGES */
        .badge {
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            border: 1px solid transparent;
            transition: all 0.2s ease;
        }

        .badge:hover {
            transform: scale(1.05);
        }

        .badge-bug {
            background: var(--webtoys-red-light);
            border-color: var(--webtoys-red);
            color: var(--webtoys-red);
            font-weight: 800;
        }

        .badge-feature {
            background: var(--lime-green-light);
            border-color: var(--lime-green);
            color: var(--lime-green);
            font-weight: 800;
        }

        .badge-enhancement {
            background: var(--sunshine-yellow-light);
            border-color: var(--sunshine-yellow);
            color: #b8860b;
            font-weight: 800;
        }

        .badge-triage {
            background: #f3e8ff;
            border-color: var(--purple-magic);
            color: var(--purple-magic);
            font-weight: 800;
        }

        .badge-status {
            background: var(--blue);
            color: var(--charcoal);
        }

        .badge-new {
            background: var(--purple-shadow);
            color: var(--charcoal);
        }

        .badge-reformulated {
            background: #ffe6e6;
            border-color: var(--orange-blast);
            color: var(--orange-blast);
            font-weight: 800;
        }

        .badge-fixed {
            background: var(--lime-green-light);
            border-color: var(--lime-green);
            color: var(--lime-green);
            font-weight: 800;
        }

        .badge-new {
            background: var(--electric-blue-light);
            border-color: var(--electric-blue);
            color: var(--electric-blue);
            font-weight: 800;
        }

        .badge-fixing {
            background: var(--sunshine-yellow-light);
            border-color: var(--sunshine-yellow);
            color: #b8860b;
            font-weight: 800;
        }

        .badge-pr-created {
            background: var(--lime-green-light);
            border-color: var(--lime-green);
            color: var(--lime-green);
            font-weight: 800;
        }

        .badge-failed {
            background: var(--webtoys-red-light);
            border-color: var(--webtoys-red);
            color: var(--webtoys-red);
            font-weight: 800;
        }
        
        .badge-closed {
            background: #f5f5f5;
            border-color: var(--charcoal-light);
            color: var(--charcoal-light);
            font-weight: 800;
        }
        
        .badge-answered {
            background: var(--electric-blue-light);
            border-color: var(--electric-blue);
            color: var(--electric-blue);
            font-weight: 800;
        }
        
        .badge-needs-info {
            background: #ffe6e6;
            border-color: var(--orange-blast);
            color: var(--orange-blast);
            font-weight: 800;
        }
        
        .badge-admin-discussion {
            background: #f3e8ff;
            border-color: var(--purple-magic);
            color: var(--purple-magic);
            font-weight: 800;
            animation: gentle-pulse 2s infinite;
        }
        
        @keyframes gentle-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .badge-documentation {
            background: var(--electric-blue-light);
            border-color: var(--electric-blue);
            color: var(--electric-blue);
            font-weight: 800;
        }

        .status-timeline {
            display: flex;
            align-items: center;
            margin-top: 15px;
            padding: 20px 10px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 20px;
            position: relative;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(42, 42, 42, 0.1);
        }

        .status-step {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 4px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            position: relative;
            z-index: 2;
            color: var(--gray-warm);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .status-step.completed {
            color: var(--green-sage);
            font-weight: 700;
        }

        .status-step.current {
            color: var(--charcoal);
            font-weight: 800;
            transform: scale(1.05);
        }
        
        .status-step.blocked {
            color: var(--red);
            font-weight: 700;
        }
        
        .status-step.pending {
            color: #ccc;
            font-weight: 500;
        }
        
        @keyframes pulse {
            0% { 
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(255, 214, 61, 0.7);
            }
            50% { 
                transform: scale(1.1);
                box-shadow: 0 0 0 10px rgba(255, 214, 61, 0);
            }
            100% { 
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(255, 214, 61, 0);
            }
        }
        
        .status-circle {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-bottom: 8px;
            position: relative;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 3px solid;
        }
        
        .status-circle.completed {
            background: var(--green-sage);
            border-color: var(--green-sage);
            box-shadow: 0 0 0 4px rgba(127, 176, 105, 0.2), 
                        0 2px 8px rgba(127, 176, 105, 0.4);
        }
        
        .status-circle.completed::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 12px;
            font-weight: 900;
        }
        
        .status-circle.current {
            background: var(--yellow);
            border-color: var(--yellow);
            animation: pulse-circle 2s infinite;
            box-shadow: 0 0 0 4px rgba(255, 214, 61, 0.3);
        }
        
        .status-circle.current::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: var(--charcoal);
            border-radius: 50%;
            animation: pulse-dot 1.5s infinite;
        }
        
        .status-circle.pending {
            background: transparent;
            border-color: #ddd;
            box-shadow: none;
        }
        
        .status-circle.blocked {
            background: var(--red);
            border-color: var(--red);
            box-shadow: 0 0 0 4px rgba(255, 75, 75, 0.2);
        }
        
        .status-circle.blocked::after {
            content: '‚úó';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 12px;
            font-weight: 900;
        }
        
        @keyframes pulse-circle {
            0% {
                box-shadow: 0 0 0 4px rgba(255, 214, 61, 0.3);
                transform: scale(1);
            }
            50% {
                box-shadow: 0 0 0 8px rgba(255, 214, 61, 0.1);
                transform: scale(1.05);
            }
            100% {
                box-shadow: 0 0 0 4px rgba(255, 214, 61, 0.3);
                transform: scale(1);
            }
        }
        
        @keyframes pulse-dot {
            0%, 100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 0.5; transform: translate(-50%, -50%) scale(1.2); }
        }
        
        /* Connection lines between status circles */
        .status-step:not(:last-child)::before {
            content: '';
            position: absolute;
            top: 12px;
            right: -50%;
            width: 100%;
            height: 2px;
            background: linear-gradient(to right, transparent 24px, #ddd 24px, #ddd calc(100% - 24px), transparent calc(100% - 24px));
            z-index: 1;
        }
        
        .status-step.completed:not(:last-child)::before {
            background: linear-gradient(to right, transparent 24px, var(--green-sage) 24px, var(--green-sage) calc(100% - 24px), transparent calc(100% - 24px));
        }
        
        .status-step.current:not(:last-child)::before {
            background: linear-gradient(to right, transparent 24px, var(--yellow) 24px, #ddd calc(50%), #ddd calc(100% - 24px), transparent calc(100% - 24px));
        }
        
        @media (max-width: 768px) {
            .status-timeline {
                padding: 15px 5px;
            }
            
            .status-step {
                font-size: 0.55rem;
                padding: 4px 2px;
            }
            
            .status-circle {
                width: 20px;
                height: 20px;
                margin-bottom: 6px;
            }
            
            .status-circle.completed::after,
            .status-circle.blocked::after {
                font-size: 10px;
            }
            
            .status-step:not(:last-child)::before {
                top: 10px;
                background: linear-gradient(to right, transparent 20px, #ddd 20px, #ddd calc(100% - 20px), transparent calc(100% - 20px));
            }
            
            .status-step.completed:not(:last-child)::before {
                background: linear-gradient(to right, transparent 20px, var(--green-sage) 20px, var(--green-sage) calc(100% - 20px), transparent calc(100% - 20px));
            }
            
            .status-step.current:not(:last-child)::before {
                background: linear-gradient(to right, transparent 20px, var(--yellow) 20px, #ddd calc(50%), #ddd calc(100% - 20px), transparent calc(100% - 20px));
            }
        }

        /* REACTIONS */
        .reactions {
            display: flex;
            gap: var(--space-sm);
            margin-top: var(--space-md);
        }

        .reaction-btn {
            background: white;
            border: 1.5px solid rgba(65, 153, 225, 0.2);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
            font-size: 13px;
            color: var(--charcoal);
        }

        .reaction-btn:hover {
            border-color: var(--electric-blue);
            transform: translateY(-1px);
            background: var(--electric-blue-light);
        }

        .vote-count {
            font-weight: 700;
            margin-left: 2px;
        }
        
        /* Superpower Controls */
        .superpower-controls {
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(135deg, var(--yellow) 0%, #FFE066 100%);
            border: 3px solid var(--charcoal);
            border-radius: 15px;
            box-shadow: 3px 3px 0px var(--charcoal);
            display: none; /* Hidden by default, shown when authenticated */
        }
        
        .superpower-controls.authenticated {
            display: block;
        }
        
        .superpower-title {
            font-weight: 800;
            color: var(--charcoal);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 14px;
        }
        
        .superpower-actions {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .superpower-dropdown {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .superpower-dropdown label {
            font-weight: 700;
            color: var(--charcoal);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .superpower-select {
            background: var(--cream);
            color: var(--charcoal);
            border: 2px solid var(--charcoal);
            padding: 8px 12px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 2px 2px 0px var(--charcoal);
            width: 100%;
        }
        
        .superpower-select:hover {
            background: var(--yellow-soft);
            transform: translateY(-1px);
            box-shadow: 3px 3px 0px var(--charcoal);
        }
        
        .superpower-select:focus {
            outline: none;
            background: var(--blue);
            color: var(--charcoal);
        }
        
        .superpower-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .superpower-btn {
            background: var(--blue);
            color: var(--charcoal);
            border: 2px solid var(--charcoal);
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 2px 2px 0px var(--charcoal);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .superpower-btn:hover {
            background: var(--green-mint);
            transform: translateY(-2px);
            box-shadow: 3px 4px 0px var(--charcoal);
        }
        
        .superpower-btn:active {
            transform: translateY(0px);
            box-shadow: 1px 1px 0px var(--charcoal);
        }
        
        .superpower-btn.close {
            background: var(--red-soft);
        }
        
        .superpower-btn.triage {
            background: var(--purple-shadow);
        }
        
        .superpower-btn.comment {
            background: var(--green-mint);
        }
        
        .superpower-btn.hide {
            background: var(--yellow);
        }
        
        .superpower-btn.unhide {
            background: var(--blue);
        }
        
        .superpower-btn.reopen {
            background: var(--green-mint);
        }
        
        .superpower-btn.delete {
            background: var(--red-soft);
        }
        
        .superpower-btn.submit {
            background: var(--green-mint);
        }
        
        .superpower-btn.cancel {
            background: var(--gray-warm);
            color: white;
        }
        
        .quick-comment {
            display: none;
            margin-top: 10px;
        }
        
        .quick-comment.show {
            display: block;
        }
        
        .quick-comment textarea {
            width: 100%;
            min-height: 80px;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .quick-comment .actions {
            display: flex;
            gap: 10px;
        }
        
        .superpower-loading {
            display: none;
            color: var(--charcoal);
            font-weight: 600;
            font-size: 14px;
            text-align: center;
            padding: 10px;
        }
        
        @media (max-width: 768px) {
            .superpower-actions {
                gap: 10px;
            }
            
            .superpower-btn {
                padding: 6px 12px;
                font-size: 10px;
            }
            
            .superpower-select {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            .superpower-dropdown label {
                font-size: 11px;
            }
            
            .superpower-buttons {
                gap: 6px;
            }
        }

        .loading {
            text-align: center;
            padding: var(--space-xl);
            color: var(--electric-blue);
            font-weight: 700;
            font-size: 1.2rem;
        }

        .loading::before {
            content: 'üöÄ ';
            animation: bounceIn 1s ease-in-out infinite;
        }

        .error {
            background: var(--webtoys-red-light);
            color: var(--webtoys-red);
            padding: var(--space-lg) var(--space-xl);
            border-radius: 16px;
            margin-bottom: var(--space-lg);
            border: 2px solid var(--webtoys-red);
            font-weight: 700;
            font-size: 16px;
        }

        .error::before {
            content: 'üö® ';
        }

        .success {
            background: var(--lime-green-light);
            color: var(--lime-green);
            padding: var(--space-lg) var(--space-xl);
            border-radius: 16px;
            margin-bottom: var(--space-lg);
            border: 2px solid var(--lime-green);
            font-weight: 700;
            font-size: 16px;
            animation: bounceIn 0.5s ease-out;
        }

        .success::before {
            content: 'üéâ ';
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: var(--gray-warm);
            font-weight: 600;
            font-size: 18px;
        }
        
        /* FILTER CONTROLS */
        .filter-controls {
            display: flex;
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
            flex-wrap: wrap;
            padding: var(--space-lg);
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 1px solid rgba(65, 153, 225, 0.1);
        }
        
        .filter-btn {
            background: rgba(255, 255, 255, 0.9);
            color: var(--charcoal);
            border: 2px solid var(--electric-blue-light);
            padding: 14px 24px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            text-transform: uppercase;
            letter-spacing: 0.3px;
            position: relative;
            overflow: hidden;
        }

        .filter-btn::before {
            content: '‚ú®';
            position: absolute;
            top: 50%;
            left: -20px;
            transform: translateY(-50%);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .filter-btn:hover {
            background: var(--electric-blue-light);
            transform: translateY(-3px);
            border-color: var(--electric-blue);
            box-shadow: 0 8px 20px rgba(0, 170, 255, 0.2);
        }

        .filter-btn:hover::before {
            left: 8px;
            opacity: 1;
        }
        
        .filter-btn.active {
            background: var(--electric-blue);
            color: white;
            border-color: var(--electric-blue);
            box-shadow: 0 6px 16px rgba(0, 170, 255, 0.4);
            transform: scale(1.05);
        }

        .filter-btn.active::before {
            content: 'üéØ';
            left: 8px;
            opacity: 1;
        }
        
        .issue-number {
            font-weight: 800;
            color: var(--electric-blue);
            font-size: 1.2rem;
            margin-bottom: var(--space-md);
            display: inline-block;
            padding: 8px 16px;
            background: var(--electric-blue-light);
            border: 2px solid var(--electric-blue);
            border-radius: 12px;
            /* transform: rotate(-2deg); */
            transition: all 0.3s ease;
        }

        .issue-number:hover {
            transform: scale(1.05);
        }
        
        .confidence-priority {
            margin-top: 10px;
            padding: 10px;
            background: var(--yellow-soft);
            border-radius: 10px;
            border: 2px solid var(--charcoal);
        }
        
        .confidence-priority strong {
            color: var(--charcoal);
            display: block;
            margin-bottom: 5px;
        }
        
        .ash-comment {
            margin-top: 15px;
            padding: 18px;
            background: linear-gradient(135deg, var(--blue) 0%, #87CEEB 100%);
            border-radius: 18px;
            border: 3px solid var(--blue-deep);
            box-shadow: 0 4px 12px rgba(74, 159, 212, 0.3), 2px 2px 0px var(--blue-deep);
            position: relative;
            overflow: hidden;
        }
        
        .agent-response {
            margin-top: 15px;
            padding: 20px;
            background: linear-gradient(135deg, var(--purple-shadow) 0%, #E6E6FA 100%);
            border-radius: 20px;
            border: 3px solid var(--purple-accent);
            box-shadow: 0 6px 20px rgba(139, 127, 212, 0.4), 3px 3px 0px var(--purple-accent);
            position: relative;
            overflow: hidden;
        }
        
        .agent-response::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--purple-accent), var(--blue), var(--green-mint));
            animation: conversation-shimmer 4s linear infinite;
        }
        
        @keyframes conversation-shimmer {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }
        
        .agent-response strong {
            color: var(--charcoal);
            font-weight: 800;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.7);
        }
        
        .agent-response::after {
            content: 'ü§ñüí≠';
            position: absolute;
            top: -5px;
            right: 10px;
            font-size: 20px;
            opacity: 0.7;
        }
        
        .agent-response .response-section {
            margin-bottom: 15px;
        }
        
        .agent-response .response-section:last-child {
            margin-bottom: 0;
        }
        
        .agent-response ul {
            margin: 8px 0;
            padding-left: 20px;
        }
        
        .agent-response li {
            margin-bottom: 4px;
            color: var(--charcoal);
        }
        
        .ash-comment::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--yellow), var(--green-mint), var(--purple-shadow));
            animation: rainbow-shimmer 3s linear infinite;
        }
        
        @keyframes rainbow-shimmer {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }
        
        .ash-comment strong {
            color: var(--charcoal);
            font-weight: 800;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
        }
        
        .ash-comment::after {
            content: 'üí≠';
            position: absolute;
            top: -5px;
            right: 10px;
            font-size: 24px;
            opacity: 0.6;
        }
        
        @media (max-width: 768px) {
            .filter-controls {
                padding: var(--space-md);
                gap: var(--space-sm);
            }
            
            .filter-btn {
                padding: 10px 16px;
                font-size: 13px;
            }
            
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-title-wrapper">
                <div class="logo-wrapper" onclick="window.location.href='https://webtoys.ai'">
                    <img src="/webtoys-simple-logo.png" alt="WEBTOYS" class="webtoys-logo-img">
                </div>
                <div class="title-section">
                    <h1>WEBTOYS FIXIT BOARD</h1>
                </div>
            </div>
            <div class="subtitle-section">
                <p class="subtitle">Drop your bugs, float your feature dreams.<br>
                I'll reply in minutes and if you're lucky, I'll send you a shiny PR.<br>
                Reality check: this is v0.1, still stretching its legs. Sometimes it nails it. More often‚Ä¶ not.<br>
                ‚Äî Ash.tag üêõ</p>
            </div>
            <div id="superpowerIndicator" class="superpower-indicator not-authenticated" style="display: none;">
                ‚ö° SUPERPOWER MODE - NOT AUTHENTICATED
            </div>
        </header>

        <div class="card">
            <h2>Submit New Issue</h2>
            <div id="submitForm">
                <div class="form-group">
                    <label for="idea">What's broken? üî®</label>
                    <textarea id="idea" placeholder="Tell us what's bugging you or what cool feature you're dreaming of..." required></textarea>
                </div>

                <div class="form-group">
                    <label for="author">Your Name (or superhero alias) ü¶∏</label>
                    <input type="text" id="author" placeholder="Anonymous Hero" />
                </div>

                <div class="form-group">
                    <label for="category">What kind of chaos? üé¶</label>
                    <select id="category">
                        <option value="triage">üîç Needs Investigation</option>
                        <option value="bug">üêõ Bug Hunt</option>
                        <option value="feature">‚ú® Feature Magic</option>
                        <option value="enhancement">üöÄ Make It Better</option>
                        <option value="documentation">üìö Docs Drama</option>
                        <option value="plan">üìã Create a Plan</option>
                        <option value="research">üî¨ Research This</option>
                        <option value="question">‚ùì Answer My Question</option>
                    </select>
                </div>

                <button onclick="submitIssue()">üöÄ Ship This Issue</button>
            </div>

            <div id="message"></div>
        </div>

        <!-- Issues Section Header -->
        <h2 style="color: var(--charcoal); font-weight: 800; margin-bottom: var(--space-lg); text-align: center; font-size: clamp(1.8rem, 4vw, 2.5rem);">Issues</h2>
        
        <!-- Filter Controls -->
        <div class="filter-controls" style="margin-bottom: var(--space-xl); display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
            <button class="filter-btn active" onclick="setFilter('all')" data-filter="all">All Issues</button>
            <button class="filter-btn" onclick="setFilter('active')" data-filter="active">Active</button>
            <button class="filter-btn" onclick="setFilter('admin_discussion')" data-filter="admin_discussion">Admin Discussion</button>
            <button class="filter-btn" onclick="setFilter('resolved')" data-filter="resolved">Resolved</button>
            <button class="filter-btn" onclick="setFilter('new')" data-filter="new">New</button>
            <button class="filter-btn" onclick="setFilter('fixing')" data-filter="fixing">In Progress</button>
            <button class="filter-btn" onclick="setFilter('closed')" data-filter="closed">Closed</button>
        </div>
        
        <div id="issueList" class="issue-list">
            <div class="loading">Loading issues...</div>
        </div>
        
        <!-- Pagination Controls - Now outside the card -->
        <div class="pagination-controls" id="paginationControls" style="display: none; margin-top: 20px; margin-bottom: 30px;">
            <button onclick="changePage(-1)" id="prevBtn">‚Üê Previous</button>
            <div class="pagination-info" id="paginationInfo">Page 1 of 1</div>
            <button onclick="changePage(1)" id="nextBtn">Next ‚Üí</button>
        </div>
    </div>

    <script>
        // ZAD Configuration
        window.APP_ID = '83218c2e-281e-4265-a95f-1d3f763870d4';
        
        // Superpower mode detection
        const urlParams = new URLSearchParams(window.location.search);
        const isSuperpowerMode = urlParams.get('superpower') === 'true';
        let isAuthenticated = false;
        let authToken = null;
        let apiUrl = null;
        
        // Pagination state
        let currentPage = 1;
        let issuesPerPage = 10;
        let allIssues = [];
        let filteredIssues = [];
        let currentFilter = 'all';
        
        // Content filtering - offensive words to hide
        const OFFENSIVE_WORDS = ['fuck', 'shit', 'damn', 'asshole', 'bitch', 'bastard', 'crap'];
        
        // Superpower Mode Functions
        async function checkExtensionAuth() {
            if (!isSuperpowerMode) return false;
            
            console.log('üîç Checking extension auth via postMessage bridge...');
            
            try {
                // Check if we already have auth data from the bridge
                if (window.SUPERPOWER_AUTH) {
                    if (!window.SUPERPOWER_AUTH.pending) {
                        // Auth check is complete
                        if (window.SUPERPOWER_AUTH.isAuthenticated) {
                            authToken = window.SUPERPOWER_AUTH.authToken;
                            apiUrl = window.SUPERPOWER_AUTH.apiUrl;
                            isAuthenticated = true;
                            console.log('üîë Auth success via postMessage bridge');
                            return true;
                        } else {
                            console.log('üîí Auth failed via postMessage bridge');
                            return false;
                        }
                    } else {
                        // Auth is still pending, wait for it
                        console.log('‚è≥ Auth check pending, waiting for response...');
                        return new Promise((resolve) => {
                            // Set up listener for auth response
                            const listener = (event) => {
                                if (event.detail && event.detail.isAuthenticated !== undefined) {
                                    window.removeEventListener('superpowerAuthReceived', listener);
                                    
                                    if (event.detail.isAuthenticated) {
                                        authToken = event.detail.authToken;
                                        apiUrl = event.detail.apiUrl;
                                        isAuthenticated = true;
                                        console.log('üîë Auth success after wait');
                                        resolve(true);
                                    } else {
                                        console.log('üîí Auth failed after wait');
                                        resolve(false);
                                    }
                                }
                            };
                            
                            window.addEventListener('superpowerAuthReceived', listener);
                            
                            // Timeout after 5 seconds
                            setTimeout(() => {
                                window.removeEventListener('superpowerAuthReceived', listener);
                                console.log('‚è∞ Auth check timeout');
                                resolve(false);
                            }, 5000);
                        });
                    }
                } else {
                    // No bridge setup, try direct fallback methods
                    console.log('üîÑ No postMessage bridge, trying fallback methods...');
                    
                    // Fallback: Check localStorage for auth (development mode)
                    const storedToken = localStorage.getItem('webtoysAuthToken');
                    const storedUrl = localStorage.getItem('webtoysApiUrl');
                    if (storedToken && storedUrl) {
                        authToken = storedToken;
                        apiUrl = storedUrl;
                        isAuthenticated = true;
                        console.log('üîë Auth success via localStorage fallback');
                        return true;
                    }
                    
                    console.log('üîí No auth found in fallback methods');
                    return false;
                }
            } catch (error) {
                console.error('üö® Extension auth check failed:', error);
                return false;
            }
        }
        
        async function callSuperpowerAPI(action, data) {
            if (!isAuthenticated || !authToken || !apiUrl) {
                throw new Error('Not authenticated for superpower actions');
            }
            
            const response = await fetch(`${apiUrl}/api/wtaf/issue-tracker`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': authToken
                },
                body: JSON.stringify({
                    action: action,
                    ...data
                })
            });
            
            if (!response.ok) {
                throw new Error(`API error: ${response.status}`);
            }
            
            return response.json();
        }
        
        // ZAD Helper Functions (injected by WEBTOYS)
        async function save(actionType, data, participantData = null) {
            const participantId = localStorage.getItem('participant_id') || 
                                 'user_' + Math.random().toString(36).substr(2, 9);
            
            if (!localStorage.getItem('participant_id')) {
                localStorage.setItem('participant_id', participantId);
            }

            // Use relative URL - works correctly in srcDoc iframes
            const response = await fetch('/api/zad/save', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    app_id: window.APP_ID,
                    participant_id: participantId,
                    action_type: actionType,
                    content_data: data,
                    participant_data: participantData
                })
            });
            return response.json();
        }

        async function load(actionType, filters = {}) {
            try {
                // Build query parameters for GET request
                const params = new URLSearchParams({
                    app_id: window.APP_ID,
                    action_type: actionType
                });
                
                // Add any additional filters
                if (filters.participant_id) {
                    params.append('participant_id', filters.participant_id);
                }
                
                // Use relative URL for API calls (works in srcDoc iframes)
                const url = `/api/zad/load?${params.toString()}`;
                console.log('Fetching from:', url);
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('API response:', result);
                
                // The API returns an array directly, not wrapped in { data: [] }
                return Array.isArray(result) ? result : (result.data || []);
            } catch (error) {
                console.error('Load function error:', error);
                throw error;
            }
        }

        // Application Functions
        async function submitIssue() {
            const author = document.getElementById('author').value || 'Anonymous';
            const category = document.getElementById('category').value;
            const idea = document.getElementById('idea').value;

            if (!idea.trim()) {
                showMessage('Please describe your issue or feature request', 'error');
                return;
            }

            // No more issue_number field - database ID is the only number
            
            const issueData = {
                idea: idea,
                author: author,
                category: category,
                status: 'new',
                // issue_number removed - we use database ID only
                comments: [],
                reactions: {
                    'üëç': 0,
                    'üî•': 0,
                    '‚ù§Ô∏è': 0
                },
                timestamp: Date.now()
            };

            try {
                const result = await save('issue', issueData);
                if (result.success) {
                    showMessage('Issue submitted successfully! It will be reviewed by our automated system.', 'success');
                    document.getElementById('idea').value = '';
                    loadIssues(); // Refresh the list
                } else {
                    showMessage('Failed to submit issue. Please try again.', 'error');
                }
            } catch (error) {
                showMessage('Error submitting issue: ' + error.message, 'error');
            }
        }

        async function loadIssues() {
            try {
                console.log('Loading issues for app:', window.APP_ID);
                const issues = await load('issue');
                console.log('Loaded issues:', issues);
                
                // Store all issues globally and apply content filtering
                allIssues = filterOffensiveContent(issues);
                
                // Load votes and update counts
                await loadVotes();
                updateVoteCounts();
                
                // Apply the current filter to display issues
                applyFilter(currentFilter);
                
            } catch (error) {
                console.error('Error loading issues:', error);
                document.getElementById('issueList').innerHTML = 
                    '<div class="error">Failed to load issues: ' + error.message + '</div>';
            }
        }

        // Content filtering function
        function filterOffensiveContent(issues) {
            return issues.filter(issue => {
                const data = issue.content_data || {};
                
                // Filter out hidden issues for non-superpower users
                if (!isSuperpowerMode && data.hidden === true) {
                    return false;
                }
                
                // Filter out offensive content
                const text = (data.idea || '').toLowerCase();
                return !OFFENSIVE_WORDS.some(word => text.includes(word));
            });
        }
        
        // Filter issues by status
        function applyFilter(filter) {
            currentFilter = filter;
            
            // Update filter button states
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.filter === filter) {
                    btn.classList.add('active');
                }
            });
            
            // Filter issues based on status
            switch (filter) {
                case 'active':
                    filteredIssues = allIssues.filter(issue => {
                        const status = issue.content_data?.status || 'new';
                        return ['new', 'reformulated', 'fixing', 'admin_discussion'].includes(status);
                    });
                    break;
                case 'admin_discussion':
                    filteredIssues = allIssues.filter(issue => {
                        const status = issue.content_data?.status || 'new';
                        return status === 'admin_discussion';
                    });
                    break;
                case 'resolved':
                    filteredIssues = allIssues.filter(issue => {
                        const status = issue.content_data?.status || 'new';
                        return ['fixed', 'pr-created'].includes(status);
                    });
                    break;
                case 'closed':
                    filteredIssues = allIssues.filter(issue => {
                        const status = issue.content_data?.status || 'new';
                        return ['closed', 'wontfix'].includes(status);
                    });
                    break;
                case 'new':
                    filteredIssues = allIssues.filter(issue => {
                        const status = issue.content_data?.status || 'new';
                        return status === 'new';
                    });
                    break;
                case 'fixing':
                    filteredIssues = allIssues.filter(issue => {
                        const status = issue.content_data?.status || 'new';
                        return status === 'fixing';
                    });
                    break;
                default:
                    filteredIssues = [...allIssues];
            }
            
            // Reset to page 1 and display
            currentPage = 1;
            displayFilteredIssues();
        }
        
        // Set filter function called by buttons
        function setFilter(filter) {
            applyFilter(filter);
        }
        
        // Pagination functions
        function changePage(direction) {
            const totalPages = Math.ceil(filteredIssues.length / issuesPerPage);
            const newPage = currentPage + direction;
            
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                displayFilteredIssues();
            }
        }
        
        // Generate issue number - use stored number or create sequential one
        function generateIssueNumber(issue) {
            // ALWAYS use the database ID - single source of truth
            // No more dual numbering systems!
            if (issue && issue.id) {
                return `#${issue.id}`;
            }
            
            return '#---';
        }
        
        // Removed getNextIssueNumber - we use database IDs only now
        
        // Updated display function with pagination and issue numbers
        function displayFilteredIssues() {
            const container = document.getElementById('issueList');
            const paginationControls = document.getElementById('paginationControls');
            const paginationInfo = document.getElementById('paginationInfo');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            console.log('Displaying filtered issues:', filteredIssues?.length || 0);
            
            if (!filteredIssues || filteredIssues.length === 0) {
                container.innerHTML = '<div class="loading">No issues match the current filter.</div>';
                paginationControls.style.display = 'none';
                return;
            }

            // Sort by timestamp, newest first
            filteredIssues.sort((a, b) => (b.content_data?.timestamp || 0) - (a.content_data?.timestamp || 0));
            
            // Calculate pagination
            const totalPages = Math.ceil(filteredIssues.length / issuesPerPage);
            const startIndex = (currentPage - 1) * issuesPerPage;
            const endIndex = Math.min(startIndex + issuesPerPage, filteredIssues.length);
            const currentIssues = filteredIssues.slice(startIndex, endIndex);
            
            // Update pagination controls
            paginationControls.style.display = totalPages > 1 ? 'flex' : 'none';
            paginationInfo.textContent = `Page ${currentPage} of ${totalPages} (${filteredIssues.length} issues)`;
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;

            container.innerHTML = currentIssues.map(issue => {
                const data = issue.content_data || {};
                const status = data.status || 'new';
                const category = data.category || 'triage';
                const issueNumber = generateIssueNumber(issue);
                
                // Enhanced status progression for all flows
                let statusSteps;
                if (status === 'closed') {
                    // Check if it's a test/joke closure
                    if (data.closed_reason === 'test_joke') {
                        // Test/joke workflow - goes straight from Analyzed to Closed
                        statusSteps = [
                            { name: 'Submitted', state: 'completed' },
                            { name: 'Analyzed', state: 'completed' },
                            { name: 'Closed', state: 'completed', showIndicator: 'green' }
                        ];
                    } else {
                        // Normal closed workflow
                        statusSteps = [
                            { name: 'Submitted', state: 'completed' },
                            { name: 'Analyzed', state: 'completed' },
                            { name: 'Closed', state: 'completed', showIndicator: 'green' }
                        ];
                    }
                } else if (status === 'needs_info') {
                    // Needs more information workflow
                    statusSteps = [
                        { name: 'Submitted', state: 'completed' },
                        { name: 'Analyzed', state: 'completed' },
                        { name: 'Needs Info', state: 'current', showIndicator: 'yellow-pulse' }
                    ];
                } else if (status === 'wontfix') {
                    // Won't fix workflow
                    statusSteps = [
                        { name: 'Submitted', state: 'completed' },
                        { name: 'Analyzed', state: 'completed' },
                        { name: "Won't Fix", state: 'completed', showIndicator: 'red' }
                    ];
                } else if (status.includes('failed')) {
                    // Failed workflow - only show indicator on CURRENT status
                    statusSteps = [
                        { name: 'Submitted', state: 'completed' },
                        { name: 'Analyzed', state: data.reformulated ? 'completed' : 'current', 
                          showIndicator: data.reformulated ? null : 'yellow-pulse',
                          displayName: data.reformulated ? 'Analyzed' : 'Analyzing' },
                        { name: 'Failed', state: 'blocked', showIndicator: 'red' },
                        { name: 'Fixed', state: 'pending' },
                        { name: 'PR Created', state: 'pending' }
                    ];
                } else {
                    // Normal workflow - only show indicator on CURRENT active step
                    const isNew = status === 'new';  // Just submitted, not yet processing
                    const isAnalyzing = status === 'analyzing';  // Actually being processed
                    const isAnalyzed = status === 'reformulated' || status === 'fixing' || status === 'fixed' || status === 'pr-creating' || status === 'pr-created';
                    const isFixing = status === 'fixing';
                    const isFixed = status === 'fixed' || status === 'pr-creating' || status === 'pr-created';
                    const isPRCreating = status === 'pr-creating';
                    const isPRCreated = status === 'pr-created';
                    
                    statusSteps = [
                        { name: 'Submitted', state: 'completed', showIndicator: isNew ? 'green' : null },
                        { 
                            name: isAnalyzing ? 'Analyzing' : (isAnalyzed ? 'Analyzed' : 'Analysis Pending'),
                            state: isAnalyzing ? 'current' : (isAnalyzed ? 'completed' : 'pending'),
                            showIndicator: isAnalyzing ? 'yellow-pulse' : null
                        },
                        { 
                            name: isFixing ? 'Fixing' : 'Fixed',
                            state: isFixing ? 'current' : (isFixed ? 'completed' : 'pending'),
                            showIndicator: isFixing ? 'yellow-pulse' : null
                        },
                        { 
                            name: isPRCreating ? 'Creating PR' : (isPRCreated ? 'PR Created' : 'PR Pending'),
                            state: isPRCreating ? 'current' : (isPRCreated ? 'completed' : 'pending'),
                            showIndicator: isPRCreating ? 'yellow-pulse' : (isPRCreated ? 'green' : null)
                        }
                    ];
                }
                
                const statusBadgeClass = status === 'answered' ? 'badge-answered' :
                                        status === 'admin_discussion' ? 'badge-admin-discussion' :
                                        status === 'pr-created' ? 'badge-pr-created' : 
                                        status === 'fixed' ? 'badge-fixed' :
                                        status === 'fixing' ? 'badge-fixing' :
                                        status === 'reformulated' ? 'badge-reformulated' :
                                        status === 'closed' ? 'badge-closed' :
                                        status === 'needs_info' ? 'badge-needs-info' :
                                        status === 'wontfix' ? 'badge-failed' :
                                        status.includes('failed') ? 'badge-failed' :
                                        'badge-new';
                
                return `
                    <div class="issue-item">
                        <div class="issue-number">${issueNumber}</div>
                        <div class="issue-header">
                            <div class="issue-title">${escapeHtml(data.idea || 'No description')}</div>
                        </div>
                        <div class="issue-meta">
                            <span class="badge badge-${category}">${category}</span>
                            <span class="badge ${statusBadgeClass}">${status.replace('-', ' ')}</span>
                            <span>by ${escapeHtml(data.author || 'Anonymous')}</span>
                            <span>${formatDate(data.timestamp)}</span>
                        </div>
                        
                        <div class="status-timeline">
                            ${statusSteps.map((step) => {
                                const className = step.state || 'pending';
                                const circleClass = step.state || 'pending';
                                return `<div class="status-step ${className}">
                                    <div class="status-circle ${circleClass}"></div>
                                    <span>${step.displayName || step.name}</span>
                                </div>`;
                            }).join('')}
                        </div>
                        
                        ${data.answer ? `
                            <div class="ash-comment" style="margin-top: 15px; background: linear-gradient(135deg, var(--blue) 0%, #87CEEB 100%); border: 2px solid var(--blue-deep);">
                                <strong style="color: var(--charcoal);">üé∏ Ash.tag says:</strong><br>
                                <span style="color: var(--charcoal);">${createTruncatedText(data.answer)}</span>
                                ${data.ash_comment ? `
                                    <div style="margin-top: 10px; padding-top: 10px; border-top: 2px solid rgba(0,0,0,0.1);">
                                        <em style="color: var(--charcoal);">${createTruncatedText(data.ash_comment)}</em>
                                    </div>
                                ` : ''}
                                ${data.followup_action ? `
                                    <div style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.5); border-radius: 10px;">
                                        <strong>Next Step:</strong> ${escapeHtml(data.followup_action)}
                                    </div>
                                ` : ''}
                            </div>
                        ` : ''}
                        
                        ${data.confidence || data.priority ? `
                            <div class="confidence-priority">
                                ${data.confidence ? `<strong>Confidence: ${data.confidence}</strong>` : ''}
                                ${data.priority ? `<strong>Priority: ${data.priority}</strong>` : ''}
                            </div>
                        ` : ''}
                        
                        ${
                            // UNIFIED ASH.TAG VOICE - Show the most relevant content
                            data.ash_explanation ? `
                                <div class="ash-comment" style="background: linear-gradient(135deg, var(--green-mint) 0%, #98FB98 100%); border-color: var(--green-deep);">
                                    <strong>üé∏ Ash.tag Fixed This:</strong> ${createTruncatedText(data.ash_explanation)}
                                    ${data.technical_summary ? `
                                        <div style="margin-top: 10px; padding-top: 10px; border-top: 2px solid rgba(255,255,255,0.3);">
                                            <strong>Technical Details:</strong>
                                            <pre style="white-space: pre-wrap; font-size: 12px; margin: 5px 0;">${escapeHtml(data.technical_summary)}</pre>
                                        </div>
                                    ` : ''}
                                </div>
                            ` : (data.ash_comment && !data.answer) ? `
                                <div class="ash-comment">
                                    <strong>üé∏ Ash.tag:</strong> ${createTruncatedText(data.ash_comment)}
                                    ${data.reformulated && data.status !== 'Canceled' && data.status !== 'closed' ? `
                                        <div style="margin-top: 10px; padding-top: 10px; border-top: 2px solid rgba(255,255,255,0.3);">
                                            <strong>Technical Analysis:</strong> ${createTruncatedText(data.reformulated)}
                                        </div>
                                    ` : ''}
                                </div>
                            ` : data.reformulated ? `
                                <div class="ash-comment">
                                    <strong>üé∏ Ash.tag's Analysis:</strong> ${createTruncatedText(data.reformulated)}
                                </div>
                            ` : ''
                        }
                        
                        ${data.agent_response ? `
                            <div class="agent-response">
                                <strong>ü§ñ Ash.tag's Detailed Response:</strong>
                                <div class="response-section">
                                    ${formatAgentResponse(data.agent_response)}
                                </div>
                                ${data.agent_response_timestamp ? `<div style="font-size: 12px; opacity: 0.7; margin-top: 10px;">Response generated: ${formatDate(new Date(data.agent_response_timestamp).getTime())}</div>` : ''}
                            </div>
                        ` : ''}
                        
                        ${data.plan_content ? `
                            <div style="margin-top: 15px; padding: 20px; background: linear-gradient(135deg, var(--yellow-light) 0%, #FFFACD 100%); border-radius: 15px; border: 3px solid var(--yellow); box-shadow: 2px 2px 0px var(--yellow);">
                                <strong style="color: var(--charcoal);">üìã Plan Created:</strong>
                                ${data.github_link ? `
                                    <a href="${data.github_link}" target="_blank" style="float: right; color: var(--charcoal); font-weight: 700; text-decoration: underline;">
                                        View on GitHub ‚Üí
                                    </a>
                                ` : ''}
                                <div style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.5); border-radius: 10px;">
                                    <pre style="white-space: pre-wrap; font-family: monospace; font-size: 13px; color: var(--charcoal);">${escapeHtml(data.plan_content)}</pre>
                                </div>
                            </div>
                        ` : ''}
                        
                        ${data.pr_url ? `
                            <div style="margin-top: 15px; padding: 15px; background: var(--green-mint); border-radius: 15px; border: 3px solid var(--green-sage); box-shadow: 2px 2px 0px var(--green-sage);">
                                <strong style="color: var(--charcoal);">üéâ Pull Request Created!</strong><br>
                                <a href="${data.pr_url}" target="_blank" style="color: var(--charcoal); font-weight: 700; text-decoration: underline;">
                                    View Pull Request #${data.pr_url.split('/').pop()} ‚Üí
                                </a>
                            </div>
                        ` : ''}
                        
                        ${renderAdminComments(data.admin_comments)}
                        
                        <div class="reactions" data-issue-id="${issue.id}">
                            <button class="reaction-btn upvote" onclick="toggleVote('${issue.id}', 'upvote')">
                                ‚ñ≤ <span class="vote-count">${data.upvotes || 0}</span>
                            </button>
                            <button class="reaction-btn downvote" onclick="toggleVote('${issue.id}', 'downvote')">
                                ‚ñº <span class="vote-count">${data.downvotes || 0}</span>
                            </button>
                        </div>
                        
                        ${generateSuperpowerControls(issue)}
                    </div>
                `;
            }).join('');
        }
        
        // Legacy function for backward compatibility
        function displayIssues(issues) {
            allIssues = filterOffensiveContent(issues);
            applyFilter(currentFilter);
        }

        // Store all votes globally
        let allVotes = [];
        
        // Toggle vote (upvote or downvote)
        async function toggleVote(issueId, voteType) {
            try {
                const participantId = localStorage.getItem('participant_id') || 
                                    'anon_' + Math.random().toString(36).substr(2, 9);
                
                // Store participant ID if new
                if (!localStorage.getItem('participant_id')) {
                    localStorage.setItem('participant_id', participantId);
                }
                
                // Check if user already voted on this issue
                const existingVote = allVotes.find(v => 
                    v.content_data?.issue_id === issueId && 
                    v.content_data?.voter === participantId
                );
                
                let newVoteType;
                if (existingVote && existingVote.content_data?.vote_type === voteType) {
                    // Same vote - remove it (toggle off)
                    newVoteType = 'none';
                } else {
                    // New vote or different vote
                    newVoteType = voteType;
                }
                
                // Save the vote
                await save('vote', {
                    issue_id: issueId,
                    voter: participantId,
                    vote_type: newVoteType,
                    timestamp: Date.now()
                });
                
                // Reload votes and update display
                await loadVotes();
                updateVoteCounts();
                
                showMessage(
                    newVoteType === 'none' ? 'Vote removed' : `Issue ${voteType}d!`, 
                    'success'
                );
                
            } catch (error) {
                showMessage('Failed to save vote: ' + error.message, 'error');
            }
        }
        
        // Load all votes from backend
        async function loadVotes() {
            try {
                allVotes = await load('vote');
                console.log('Loaded votes:', allVotes.length);
            } catch (error) {
                console.error('Error loading votes:', error);
                allVotes = [];
            }
        }
        
        // Update vote counts for all issues
        function updateVoteCounts() {
            // Get latest vote per user per issue
            const votesByUserIssue = {};
            allVotes.forEach(vote => {
                const data = vote.content_data || {};
                const key = `${data.voter}-${data.issue_id}`;
                
                // Keep only the latest vote from each user for each issue
                if (!votesByUserIssue[key] || 
                    data.timestamp > votesByUserIssue[key].timestamp) {
                    votesByUserIssue[key] = data;
                }
            });
            
            // Count votes per issue
            const voteCounts = {};
            Object.values(votesByUserIssue).forEach(vote => {
                if (vote.vote_type && vote.vote_type !== 'none') {
                    if (!voteCounts[vote.issue_id]) {
                        voteCounts[vote.issue_id] = { upvotes: 0, downvotes: 0 };
                    }
                    if (vote.vote_type === 'upvote') {
                        voteCounts[vote.issue_id].upvotes++;
                    } else if (vote.vote_type === 'downvote') {
                        voteCounts[vote.issue_id].downvotes++;
                    }
                }
            });
            
            // Update the allIssues array with vote counts
            allIssues.forEach(issue => {
                const counts = voteCounts[issue.id] || { upvotes: 0, downvotes: 0 };
                issue.content_data = issue.content_data || {};
                issue.content_data.upvotes = counts.upvotes;
                issue.content_data.downvotes = counts.downvotes;
            });
            
            // Refresh display
            displayFilteredIssues();
        }

        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.className = type;
            messageDiv.textContent = text;
            setTimeout(() => {
                messageDiv.className = '';
                messageDiv.textContent = '';
            }, 5000);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Create truncated text with Read More/Less functionality
        function createTruncatedText(text, maxLines = 10) {
            if (!text) return '';
            
            const words = text.split(/\s+/);
            const lines = text.split('\n');
            
            // Check if truncation is needed (10 lines OR 50 words)
            if (lines.length <= maxLines && words.length <= 50) {
                return escapeHtml(text);
            }
            
            // Truncate by whichever limit is reached first
            let truncated;
            if (words.length > 50) {
                // Truncate by words
                truncated = words.slice(0, 50).join(' ');
            } else {
                // Truncate by lines
                truncated = lines.slice(0, maxLines).join('\n');
            }
            
            const fullText = text;
            const uniqueId = 'text-' + Math.random().toString(36).substr(2, 9);
            
            return `
                <span id="${uniqueId}-truncated">
                    ${escapeHtml(truncated)}
                    <a href="#" onclick="expandText('${uniqueId}'); return false;" style="color: var(--electric-blue); font-weight: 600; margin-left: 10px;">... Read More</a>
                </span>
                <span id="${uniqueId}-full" style="display: none;">
                    ${escapeHtml(fullText)}
                    <a href="#" onclick="collapseText('${uniqueId}'); return false;" style="color: var(--electric-blue); font-weight: 600; margin-left: 10px;">Show Less</a>
                </span>
            `;
        }

        // Expand text to show full content
        function expandText(id) {
            document.getElementById(id + '-truncated').style.display = 'none';
            document.getElementById(id + '-full').style.display = 'inline';
        }

        // Collapse text to show truncated version
        function collapseText(id) {
            document.getElementById(id + '-truncated').style.display = 'inline';
            document.getElementById(id + '-full').style.display = 'none';
        }

        function formatDate(timestamp) {
            if (!timestamp) return '';
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 3600000) {
                return Math.floor(diff / 60000) + ' min ago';
            } else if (diff < 86400000) {
                return Math.floor(diff / 3600000) + ' hours ago';
            } else {
                return Math.floor(diff / 86400000) + ' days ago';
            }
        }
        
        function formatAgentResponse(responseText) {
            if (!responseText) return '';
            
            // Use truncation with Read More (10 lines or 50 words)
            let formatted = createTruncatedText(responseText, 10);
            
            // Convert markdown-style formatting to HTML
            formatted = formatted
                // Convert **text** to <strong>
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                // Convert newlines to breaks
                .replace(/\n/g, '<br>')
                // Convert bullet points to list items (handle both ‚Ä¢ and - bullets)
                .replace(/^[‚Ä¢-] (.+)$/gm, '<li>$1</li>')
                // Wrap consecutive list items in ul tags
                .replace(/(<li>.*<\/li>)(\s*<br>\s*<li>.*<\/li>)*/g, function(match) {
                    // Remove <br> tags between list items and wrap in ul
                    const cleanedList = match.replace(/<br>\s*/g, '');
                    return '<ul>' + cleanedList + '</ul>';
                });
            
            return formatted;
        }
        
        // Render admin comments section
        function renderAdminComments(comments) {
            if (!comments || comments.length === 0) {
                return '';
            }
            
            return `
                <div style="margin-top: 15px; padding: 15px; background: var(--yellow-soft); border-radius: 15px; border: 2px solid var(--charcoal);">
                    <strong style="color: var(--charcoal); display: block; margin-bottom: 10px;">üí¨ Admin Comments:</strong>
                    ${comments.map(comment => `
                        <div style="margin-bottom: 10px; padding: 10px; background: white; border-radius: 10px; border: 1px solid var(--gray-warm);">
                            <div style="font-size: 12px; color: var(--gray-warm); margin-bottom: 5px;">
                                <strong>${escapeHtml(comment.author || 'Admin')}</strong>
                                ${comment.authorRole ? `<span style="background: var(--purple-shadow); padding: 2px 6px; border-radius: 5px; margin-left: 5px; font-size: 10px; text-transform: uppercase;">${escapeHtml(comment.authorRole)}</span>` : ''}
                                ‚Ä¢ ${formatDate(comment.timestamp)}
                            </div>
                            <div style="color: var(--charcoal);">${createTruncatedText(comment.text)}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Generate superpower controls HTML
        function generateSuperpowerControls(issue) {
            if (!isSuperpowerMode || !isAuthenticated) {
                return '';
            }
            
            const data = issue.content_data || {};
            const status = data.status || 'new';
            const issueId = issue.id;
            
            return `
                <div class="superpower-controls ${isAuthenticated ? 'authenticated' : ''}">
                    <div class="superpower-title">‚ö° Superpower Actions</div>
                    
                    <div class="superpower-actions">
                        <!-- Status Dropdown -->
                        <div class="superpower-dropdown">
                            <label for="status-${issueId}">Status:</label>
                            <select id="status-${issueId}" class="superpower-select" onchange="updateIssueStatus('${issueId}', this.value)">
                                <option value="new" ${status === 'new' ? 'selected' : ''}>New</option>
                                <option value="admin_discussion" ${status === 'admin_discussion' ? 'selected' : ''}>Admin Discussion</option>
                                <option value="reformulated" ${status === 'reformulated' ? 'selected' : ''}>Reformulated</option>
                                <option value="fixing" ${status === 'fixing' ? 'selected' : ''}>Fixing</option>
                                <option value="pr-creating" ${status === 'pr-creating' ? 'selected' : ''}>PR Creating</option>
                                <option value="pr-created" ${status === 'pr-created' ? 'selected' : ''}>PR Created</option>
                                <option value="fix-failed" ${status === 'fix-failed' ? 'selected' : ''}>Fix Failed</option>
                                <option value="needs_info" ${status === 'needs_info' ? 'selected' : ''}>Needs Info</option>
                                <option value="answered" ${status === 'answered' ? 'selected' : ''}>Answered</option>
                                <option value="closed" ${status === 'closed' ? 'selected' : ''}>Closed</option>
                            </select>
                        </div>
                        
                        <!-- Priority Dropdown -->
                        <div class="superpower-dropdown">
                            <label for="priority-${issueId}">Priority:</label>
                            <select id="priority-${issueId}" class="superpower-select" onchange="updateIssuePriority('${issueId}', this.value)">
                                <option value="" ${!data.priority ? 'selected' : ''}>None</option>
                                <option value="low" ${data.priority === 'low' ? 'selected' : ''}>üü¢ Low</option>
                                <option value="medium" ${data.priority === 'medium' ? 'selected' : ''}>üü° Medium</option>
                                <option value="high" ${data.priority === 'high' ? 'selected' : ''}>üü† High</option>
                                <option value="critical" ${data.priority === 'critical' ? 'selected' : ''}>üî¥ Critical</option>
                            </select>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="superpower-buttons">
                            <button class="superpower-btn ${data.hidden ? 'unhide' : 'hide'}" onclick="toggleIssueVisibility('${issueId}', ${!data.hidden})">
                                ${data.hidden ? 'üëÅÔ∏è Unhide' : 'üö´ Hide'}
                            </button>
                            
                            ${status === 'closed' ? `
                                <button class="superpower-btn reopen" onclick="reopenIssue('${issueId}')">
                                    üîÑ Reopen
                                </button>
                            ` : `
                                <button class="superpower-btn close" onclick="closeIssue('${issueId}')">
                                    ‚úÖ Close
                                </button>
                            `}
                            
                            <button class="superpower-btn comment" onclick="toggleQuickComment('${issueId}')">
                                üí¨ Comment
                            </button>
                            
                            <button class="superpower-btn delete" onclick="deleteIssue('${issueId}')">
                                üóëÔ∏è Delete
                            </button>
                        </div>
                    </div>
                    
                    <div class="quick-comment" id="comment-${issueId}">
                        <textarea id="comment-text-${issueId}" placeholder="Add your admin comment..."></textarea>
                        <div class="actions">
                            <button class="superpower-btn submit" onclick="submitComment('${issueId}')">Submit</button>
                            <button class="superpower-btn cancel" onclick="cancelComment('${issueId}')">Cancel</button>
                        </div>
                    </div>
                    
                    <div class="superpower-loading" id="loading-${issueId}">
                        Processing superpower action...
                    </div>
                </div>
            `;
        }
        
        // Enhanced Superpower Action Functions
        async function updateIssueStatus(issueId, newStatus) {
            await performSuperpowerAction(issueId, 'updateField', { 
                field: 'status', 
                value: newStatus 
            }, `Status updated to ${newStatus}`);
        }
        
        async function updateIssuePriority(issueId, newPriority) {
            await performSuperpowerAction(issueId, 'updateField', { 
                field: 'priority', 
                value: newPriority 
            }, newPriority ? `Priority set to ${newPriority}` : 'Priority cleared');
        }
        
        async function toggleIssueVisibility(issueId, shouldHide) {
            await performSuperpowerAction(issueId, 'updateField', { 
                field: 'hidden', 
                value: shouldHide 
            }, shouldHide ? 'Issue hidden' : 'Issue unhidden');
        }
        
        async function closeIssue(issueId) {
            if (confirm('Are you sure you want to close this issue?')) {
                await performSuperpowerAction(issueId, 'updateField', { 
                    field: 'status', 
                    value: 'closed' 
                }, 'Issue closed');
            }
        }
        
        async function reopenIssue(issueId) {
            await performSuperpowerAction(issueId, 'updateField', { 
                field: 'status', 
                value: 'new' 
            }, 'Issue reopened');
        }
        
        async function deleteIssue(issueId) {
            if (confirm('Are you sure you want to delete this issue? This action cannot be undone.')) {
                await performSuperpowerAction(issueId, 'delete', {}, 'Issue deleted');
            }
        }
        
        function toggleQuickComment(issueId) {
            const commentBox = document.getElementById(`comment-${issueId}`);
            const isVisible = commentBox.classList.contains('show');
            
            if (isVisible) {
                commentBox.classList.remove('show');
            } else {
                commentBox.classList.add('show');
                document.getElementById(`comment-text-${issueId}`).focus();
            }
        }
        
        async function submitComment(issueId) {
            const commentText = document.getElementById(`comment-text-${issueId}`).value.trim();
            
            if (!commentText) {
                showMessage('Please enter a comment', 'error');
                return;
            }
            
            await performSuperpowerAction(issueId, 'addComment', { comment: commentText }, 'Comment added');
            
            // Clear and hide comment box
            document.getElementById(`comment-text-${issueId}`).value = '';
            document.getElementById(`comment-${issueId}`).classList.remove('show');
        }
        
        function cancelComment(issueId) {
            document.getElementById(`comment-text-${issueId}`).value = '';
            document.getElementById(`comment-${issueId}`).classList.remove('show');
        }
        
        // Generic function to perform superpower actions
        async function performSuperpowerAction(issueId, action, data, successMessage) {
            const loadingElement = document.getElementById(`loading-${issueId}`);
            
            try {
                // Show loading
                loadingElement.style.display = 'block';
                
                // Call the admin API directly
                const apiPayload = {
                    action: action,
                    issueId: issueId,
                    ...data
                };
                
                console.log('Calling admin API with:', apiPayload);
                
                const response = await fetch('/api/wtaf/issue-tracker-admin', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(apiPayload)
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                    showMessage(successMessage, 'success');
                    // Refresh the issues to show updated data
                    await loadIssues();
                } else {
                    showMessage('Action failed: ' + (result.error || 'Unknown error'), 'error');
                }
                
            } catch (error) {
                console.error('Superpower action error:', error);
                showMessage('Failed to perform action: ' + error.message, 'error');
            } finally {
                // Hide loading
                loadingElement.style.display = 'none';
            }
        }
        
        // Initialize superpower mode
        async function initializeSuperpowerMode() {
            if (isSuperpowerMode) {
                console.log('‚ö° Superpower mode detected, checking authentication...');
                
                // Show initial loading state
                document.getElementById('superpowerIndicator').style.display = 'block';
                document.getElementById('superpowerIndicator').textContent = '‚ö° SUPERPOWER MODE - CHECKING AUTH...';
                document.getElementById('superpowerIndicator').style.background = 'var(--yellow)';
                
                const authenticated = await checkExtensionAuth();
                
                if (authenticated) {
                    console.log('‚úÖ Authentication successful');
                    document.getElementById('superpowerIndicator').textContent = '‚ö° SUPERPOWER MODE - AUTHENTICATED';
                    document.getElementById('superpowerIndicator').style.background = 'var(--green-mint)';
                    document.getElementById('superpowerIndicator').style.color = 'var(--charcoal)';
                } else {
                    console.log('‚ùå Authentication failed');
                    document.getElementById('superpowerIndicator').textContent = '‚ö° SUPERPOWER MODE - NOT AUTHENTICATED';
                    document.getElementById('superpowerIndicator').style.background = 'var(--red-soft)';
                    document.getElementById('superpowerIndicator').style.color = 'var(--charcoal)';
                }
            }
        }
        
        // Set up callback for when auth is received via postMessage
        window.onSuperpowerAuthReceived = function(authData) {
            console.log('üîÑ Auth data received via postMessage, re-initializing...');
            // Re-run the auth check now that we have data
            initializeSuperpowerMode();
        };
        
        // Load issues on page load
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üì± Page loaded, initializing...');
            
            // Initialize superpower mode first (this will wait for auth if needed)
            await initializeSuperpowerMode();
            
            // Then load issues
            loadIssues();
            
            // Removed auto-refresh to prevent losing user input
        });
    </script>
</body>
</html>
