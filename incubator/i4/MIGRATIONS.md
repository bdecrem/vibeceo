# Migrations & External Changes - i4 (Echo)

## Supabase Tables

### echo_quirky_ideas
- **Created**: 2025-12-19
- **Purpose**: Stores quirky artsy idea concepts generated by the generator
- **Schema**:
  ```sql
  id UUID PRIMARY KEY
  name TEXT NOT NULL
  concept TEXT NOT NULL
  why_interesting TEXT
  vibe TEXT
  approach INTEGER NOT NULL  -- 1, 2, 3, or 4 (legacy: 5)
  approach_input TEXT        -- constraint or seed for approaches 3/4
  collision_inputs TEXT      -- for approach 2
  created_at TIMESTAMPTZ
  ```
- **To remove**: `DROP TABLE echo_quirky_ideas CASCADE;`

### echo_quirky_posts
- **Created**: 2025-12-19
- **Purpose**: Stores text posts for each idea (5 per idea)
- **Schema**:
  ```sql
  id UUID PRIMARY KEY
  idea_id UUID REFERENCES echo_quirky_ideas(id) ON DELETE CASCADE
  text TEXT NOT NULL
  why TEXT
  post_order INTEGER
  created_at TIMESTAMPTZ
  ```
- **To remove**: `DROP TABLE echo_quirky_posts;`

### echo_quirky_images
- **Created**: 2025-12-19
- **Modified**: 2025-12-19 (added model column)
- **Purpose**: Stores image metadata and Supabase storage paths (5 per idea)
- **Schema**:
  ```sql
  id UUID PRIMARY KEY
  idea_id UUID REFERENCES echo_quirky_ideas(id) ON DELETE CASCADE
  prompt TEXT NOT NULL
  description TEXT
  storage_path TEXT          -- path in Supabase storage
  image_order INTEGER
  model TEXT                  -- 'gpt-image-1.5' or 'dall-e-3'
  created_at TIMESTAMPTZ
  ```
- **To remove**: `DROP TABLE echo_quirky_images;`

## Supabase Storage

### agent-outputs bucket (echo-quirky/ folder)
- **Created**: 2025-12-19
- **Purpose**: Stores generated DALL-E 3 images
- **Path pattern**: `echo-quirky/{idea-name}-{timestamp}-{n}.png`
- **To remove**: Delete all files in `echo-quirky/` folder via Supabase dashboard

## Rollback SQL

```sql
-- Remove all Echo quirky generator tables and data
DROP TABLE IF EXISTS echo_quirky_images;
DROP TABLE IF EXISTS echo_quirky_posts;
DROP TABLE IF EXISTS echo_quirky_ideas;

-- Images in storage must be deleted via Supabase dashboard:
-- Storage > agent-outputs > echo-quirky/ > Delete all
```
